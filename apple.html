<!DOCTYPE html>
<!--
ğŸ åƒè‹¹æœçš„å°ç§˜å¯† - å¢å¼ºç‰ˆ
âœ¨ æ”¯æŒAIå®æ—¶æ•…äº‹ç”ŸæˆåŠŸèƒ½

ğŸ“ AIæ•…äº‹ç”Ÿæˆä½¿ç”¨è¯´æ˜ï¼š

ğŸ’ æ–¹æ³•ä¸€ï¼šä½¿ç”¨DeepSeek APIå®æ—¶ç”Ÿæˆï¼ˆæ¨èï¼‰
1. æ³¨å†ŒDeepSeekè´¦å·ï¼šhttps://platform.deepseek.com
2. è·å–APIå¯†é’¥ï¼šhttps://platform.deepseek.com/api_keys
3. å°†ç¬¬471è¡Œçš„ 'your-deepseek-api-key-here' æ›¿æ¢ä¸ºæ‚¨çš„å®é™…APIå¯†é’¥
4. äº«å—ä¸“ä¸šAIä½œå®¶ä¸ºæ‚¨é‡èº«å®šåˆ¶çš„æµªæ¼«æ•…äº‹

ğŸ­ æ–¹æ³•äºŒï¼šä½¿ç”¨å†…ç½®æ¨¡æ¿ç”Ÿæˆ
- æ— éœ€é…ç½®ï¼Œå¼€ç®±å³ç”¨
- å†…ç½®8å¥—ç²¾å¿ƒè®¾è®¡çš„æ•…äº‹æ¨¡æ¿
- è‡ªåŠ¨æ ¹æ®é—®å·ç­”æ¡ˆç”Ÿæˆä¸ªæ€§åŒ–å†…å®¹

ğŸ”’ å®‰å…¨æç¤ºï¼š
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å°†APIè°ƒç”¨ç§»è‡³åç«¯æœåŠ¡å™¨
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨APIå¯†é’¥
- æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†å’Œé™æµæœºåˆ¶

ğŸ’¡ æ™ºèƒ½é™çº§ï¼šå¦‚æœAPIå¯†é’¥æœªé…ç½®æˆ–è°ƒç”¨å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨å†…ç½®æ¨¡æ¿ç”Ÿæˆ
-->
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>åƒè‹¹æœçš„å°ç§˜å¯†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'midnight': '#0f0f23',
                        'cosmic': '#1a1a2e',
                        'nebula': '#16213e',
                        'aurora': '#e91e63',
                        'rose-glow': '#ff6b9d',
                        'pink-dream': '#ffeaa7'
                    },
                    fontFamily: {
                        'elegant': ['Inter', 'system-ui', 'sans-serif'],
                        'script': ['Dancing Script', 'cursive'],
                        'chinese': ['Ma Shan Zheng', 'serif'],
                        'handwrite': ['Kalam', 'cursive'],
                        'serif': ['Noto Serif SC', 'serif'],
                        'calligraphy': ['Source Han Serif SC', 'Noto Serif SC', 'serif'],
                        'vintage': ['Zhi Mang Xing', 'cursive'],
                    },
                    backgroundImage: {
                        'cosmic-gradient': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'aurora-gradient': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                        'dream-gradient': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Ma+Shan+Zheng&family=Kalam:wght@400;700&family=Noto+Serif+SC:wght@400;500;600;700&family=Source+Han+Serif+SC:wght@400;500;600;700&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(233, 30, 99, 0.3), 
                           0 0 60px rgba(233, 30, 99, 0.1),
                           inset 0 1px 0 rgba(255, 255, 255, 0.1); 
            }
            50% { 
                box-shadow: 0 0 40px rgba(233, 30, 99, 0.5), 
                           0 0 80px rgba(233, 30, 99, 0.2),
                           inset 0 1px 0 rgba(255, 255, 255, 0.2); 
            }
        }
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(233, 30, 99, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 30px rgba(233, 30, 99, 0.7);
                transform: scale(1.05);
            }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes avatar-hover {
            0%, 100% { 
                transform: translateY(0) scale(1);
                box-shadow: 0 0 30px rgba(233, 30, 99, 0.3);
            }
            50% { 
                transform: translateY(-8px) scale(1.05);
                box-shadow: 0 0 40px rgba(233, 30, 99, 0.5);
            }
        }
        @keyframes slideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            0% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(-100%); opacity: 0; }
        }
        
        .floating { animation: float 4s ease-in-out infinite; }
        .falling { animation: fall 10s linear infinite; }
        .glow-effect { animation: glow 3s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .avatar-hover { animation: avatar-hover 3s ease-in-out infinite; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .glass-button {
            background: linear-gradient(145deg, rgba(233, 30, 99, 0.8), rgba(245, 87, 108, 0.6));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(233, 30, 99, 0.3);
        }
        
        .shimmer-effect {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .cosmic-bg {
            background: radial-gradient(ellipse at top, #1a1a2e 0%, #0f0f23 100%);
            position: relative;
        }
        
        .cosmic-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(233, 30, 99, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(245, 87, 108, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 60% 20%, rgba(255, 107, 157, 0.05) 0%, transparent 50%);
        }
        
        /* é¡µé¢æŒ‡ç¤ºå™¨ */
        .page-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .page-indicator.active {
            background: linear-gradient(135deg, #e91e63, #ff6b9d);
            transform: scale(1.2);
        }

        /* é—®å·é¡µæ»šåŠ¨æ¡æ ·å¼ */
        #quiz-page {
            overflow-y: auto;
        }
        
        #quiz-page::-webkit-scrollbar {
            width: 8px;
        }
        
        #quiz-page::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        #quiz-page::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.6), rgba(245, 87, 108, 0.8));
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #quiz-page::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.8), rgba(245, 87, 108, 1));
        }
    </style>
</head>
<body class="font-elegant cosmic-bg min-h-screen relative">
    
    <!-- é¢„è§ˆæ¡†æ¶ -->
    <div class="hidden fixed top-2 left-2 right-2 z-50 glass-card rounded-2xl p-4" id="preview-mode">
        <div class="text-white font-medium mb-3 font-serif text-sm">é¡µé¢é¢„è§ˆæ¨¡å¼</div>
        <div class="flex space-x-3 overflow-x-auto">
            <div class="flex-shrink-0 w-40 h-24 glass-card rounded-xl p-3 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('cover')">
                <div class="text-xs text-pink-300 font-medium mb-1 font-serif">å°é¢é¡µ</div>
                <div class="text-center text-lg group-hover:scale-110 transition-transform">ğŸ</div>
                <div class="text-xs text-gray-400 font-serif">æƒ…æ„Ÿå¼•å…¥</div>
            </div>
            <div class="flex-shrink-0 w-40 h-24 glass-card rounded-xl p-3 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('input')">
                <div class="text-xs text-pink-300 font-medium mb-1 font-serif">è¾“å…¥é¡µ</div>
                <div class="text-center text-lg group-hover:scale-110 transition-transform">ğŸ‘¤</div>
                <div class="text-xs text-gray-400 font-serif">ä¸ªæ€§åŒ–è®¾ç½®</div>
            </div>
            <div class="flex-shrink-0 w-40 h-24 glass-card rounded-xl p-3 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('quiz')">
                <div class="text-xs text-pink-300 font-medium mb-1 font-serif">é—®å·é¡µ</div>
                <div class="text-center text-lg group-hover:scale-110 transition-transform">ğŸ“</div>
                <div class="text-xs text-gray-400 font-serif">æƒ…æ„ŸæŒ–æ˜</div>
            </div>
            <div class="flex-shrink-0 w-40 h-24 glass-card rounded-xl p-3 cursor-pointer hover:border-aurora/50 transition-all group" onclick="showPage('result')">
                <div class="text-xs text-pink-300 font-medium mb-1 font-serif">æƒ…ä¹¦é¡µ</div>
                <div class="text-center text-lg group-hover:scale-110 transition-transform">ğŸ’Œ</div>
                <div class="text-xs text-gray-400 font-serif">æƒ…æ„Ÿè¾“å‡º</div>
            </div>
        </div>
        <button onclick="togglePreview()" class="mt-3 px-4 py-2 glass-button text-white rounded-xl font-medium hover:scale-105 transition-all font-serif text-sm">
            é€€å‡ºé¢„è§ˆ
        </button>
    </div>

    <!-- é£˜è½åŠ¨ç”»èƒŒæ™¯ -->
    <div class="fixed inset-0 pointer-events-none z-10" id="animation-bg">
        <!-- çˆ±å¿ƒé£˜è½ -->
        <div class="absolute top-0 left-[5%] text-aurora text-xl falling opacity-60" style="animation-delay: 0s;">ğŸ’•</div>
        <div class="absolute top-0 left-[25%] text-rose-glow text-lg falling opacity-70" style="animation-delay: 1s;">ğŸ’–</div>
        <div class="absolute top-0 left-[45%] text-pink-dream text-xl falling opacity-50" style="animation-delay: 2s;">ğŸ’—</div>
        <div class="absolute top-0 left-[65%] text-aurora text-lg falling opacity-80" style="animation-delay: 3s;">ğŸ’</div>
        <div class="absolute top-0 left-[85%] text-rose-glow text-xl falling opacity-60" style="animation-delay: 4s;">ğŸ’•</div>
        
        <!-- æ¨±èŠ±é£˜è½ -->
        <div class="absolute top-0 left-[15%] text-pink-300 text-lg falling opacity-60" style="animation-delay: 0.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[35%] text-pink-200 text-xl falling opacity-50" style="animation-delay: 1.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[55%] text-rose-200 text-lg falling opacity-70" style="animation-delay: 2.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[75%] text-pink-300 text-xl falling opacity-40" style="animation-delay: 3.5s;">ğŸŒ¸</div>
        <div class="absolute top-0 left-[95%] text-pink-200 text-lg falling opacity-60" style="animation-delay: 4.5s;">ğŸŒ¸</div>
    </div>

    <!-- å°é¢é¡µ -->
    <div id="cover-page" class="flex items-center justify-center min-h-screen p-8 cursor-pointer relative z-20 overflow-y-auto" onclick="nextPage()">
        <div class="text-center space-y-10 max-w-lg mx-auto">
            <!-- è‹¹æœå›¾æ ‡ -->
            <div class="text-8xl floating filter drop-shadow-2xl">ğŸ</div>
            
            <!-- ä¸»æ–‡æ¡ˆ -->
            <div class="glass-card rounded-3xl p-10 space-y-8 relative overflow-hidden">
                <!-- è£…é¥°æ€§é—ªå…‰æ•ˆæœ -->
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-aurora to-transparent shimmer-effect"></div>
                
                <div class="space-y-6">
                    <h1 class="text-3xl font-script gradient-text font-bold">
                        "åƒè‹¹æœ"çš„å°ç§˜å¯†
                    </h1>
                    <p class="text-gray-200 text-lg leading-relaxed font-serif font-light">
                        æ˜¯åªæœ‰ä½ å’Œä»–çŸ¥é“çš„äº²å¯†æš—å·
                    </p>
                    <div class="w-16 h-px bg-gradient-to-r from-aurora to-rose-glow mx-auto"></div>
                    <p class="text-gray-300 text-base leading-relaxed font-serif">
                        æ¥å§ï¼Œæ‹¿èµ·è¿™ä»½é—®å·<br>
                        <span class="gradient-text font-medium">ä¸€èµ·å“å°å¿«ä¹</span>
                    </p>
                </div>
                
                <!-- ç‚¹å‡»æç¤º -->
                <div class="pt-6">
                    <div class="inline-flex items-center space-x-3 px-8 py-4 glass-card rounded-full glow-effect group">
                        <span class="text-white font-medium font-serif">ç‚¹å‡»ä»»æ„ä½ç½®å¼€å§‹</span>
                        <div class="w-2 h-2 bg-aurora rounded-full animate-pulse"></div>
                    </div>
                </div>
            </div>
            
            <!-- åº•éƒ¨è£…é¥° -->
            <div class="flex justify-center space-x-4 opacity-40">
                <div class="text-pink-300 text-sm">ğŸ’•</div>
                <div class="text-rose-300 text-sm">ğŸ’–</div>
                <div class="text-aurora text-sm">ğŸ’—</div>
            </div>
        </div>
    </div>

    <!-- è¾“å…¥é¡µ -->
    <div id="input-page" class="hidden min-h-screen p-8 flex flex-col justify-center relative z-20">
        <!-- é¡¶éƒ¨å¤´åƒåŒºåŸŸï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ -->
        <div id="avatar-area" class="fixed top-4 left-1/2 transform -translate-x-1/2 hidden z-30">
            <div class="w-24 h-24 overflow-hidden glass-card p-1 glow-effect">
                <img id="uploaded-avatar" class="w-full h-full object-cover" src="" alt="å¤´åƒ">
            </div>
        </div>

        <div class="max-w-lg mx-auto space-y-6 mt-32 px-4">
            <!-- æ ‡é¢˜ -->
            <div class="text-center space-y-3">
                <h2 class="text-3xl font-script gradient-text font-bold">å¼€å§‹æˆ‘ä»¬çš„ç§˜å¯†</h2>
                <p class="text-gray-300 text-base font-serif font-light">è®©æˆ‘æ›´äº†è§£é‚£ä¸ªç‰¹åˆ«çš„ta</p>
                <div class="w-16 h-px bg-gradient-to-r from-aurora to-rose-glow mx-auto"></div>
            </div>

            <!-- è¾“å…¥è¡¨å• -->
            <div class="space-y-6">
                <!-- å§“åè¾“å…¥ -->
                <div class="glass-card rounded-2xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-aurora/50 to-transparent"></div>
                    <label class="block text-gray-200 font-medium mb-3 flex items-center space-x-2 font-serif">
                        <span>ğŸ‘¤</span>
                        <span>è¯·è¾“å…¥mjgçš„åå­—</span>
                    </label>
                    <input 
                        type="text" 
                        id="userName" 
                        placeholder="taçš„åå­—..."
                        autocomplete="off"
                        class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:border-aurora focus:outline-none focus:ring-2 focus:ring-aurora/20 transition-all font-serif text-base backdrop-blur-sm"
                    >
                </div>

                <!-- å›¾ç‰‡ä¸Šä¼  -->
                <div class="glass-card rounded-2xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-rose-glow/50 to-transparent"></div>
                    <label class="block text-gray-200 font-medium mb-3 flex items-center space-x-2 font-serif">
                        <span>ğŸ“·</span>
                        <span>ä¸Šä¼ mjgçš„ç…§ç‰‡</span>
                    </label>
                    <div class="relative">
                        <input 
                            type="file" 
                            id="userPhoto" 
                            accept="image/*"
                            class="hidden"
                            onchange="handleImageUpload(this)"
                        >
                        <label 
                            for="userPhoto"
                            class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-white/20 rounded-xl cursor-pointer hover:border-aurora/50 transition-all group glass-card"
                        >
                            <div class="text-aurora text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ“¸</div>
                            <span class="text-gray-300 font-medium font-serif">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</span>
                            <span class="text-gray-500 text-sm font-serif">æ”¯æŒ JPGã€PNG</span>
                        </label>
                    </div>
                </div>

                <!-- å¼€å§‹æŒ‰é’® -->
                <button 
                    id="start-quiz-btn"
                    onclick="startQuiz()"
                    disabled
                    class="w-full glass-button text-white py-4 rounded-xl font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed hover:scale-[1.02] transition-all relative overflow-hidden group font-serif"
                >
                    <span class="relative z-10">å¼€å§‹å¿ƒåŠ¨é—®å·</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-aurora to-rose-glow opacity-0 group-hover:opacity-20 transition-opacity"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- é—®å·é¡µ -->
    <div id="quiz-page" class="hidden min-h-screen relative z-20 overflow-y-auto">
        <!-- é¡¶éƒ¨å¤´åƒï¼ˆå›ºå®šæ˜¾ç¤ºï¼Œæ­£æ–¹å½¢ä¸”æ‚¬åœï¼‰ -->
        <div id="quiz-avatar" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-30">
            <div class="w-40 h-40 overflow-hidden glass-card p-2 avatar-hover rounded-2xl shadow-2xl">
                <img id="quiz-avatar-img" class="w-full h-full object-cover rounded-xl" src="" alt="å¤´åƒ">
            </div>
        </div>

        <!-- é—®é¢˜å†…å®¹åŒº -->
        <div class="pt-48 pb-16 px-4 max-w-xl mx-auto">
            <!-- åˆå¹¶çš„é—®é¢˜+ç­”æ¡ˆæ¡† -->
            <div class="glass-card rounded-3xl p-6 mb-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-aurora/50 to-transparent"></div>
                
                <!-- é—®é¢˜æ–‡æœ¬ -->
                <h3 id="question-text" class="text-xl font-chinese text-gray-100 leading-relaxed text-left mb-6">
                    <!-- åŠ¨æ€é—®é¢˜å†…å®¹ -->
                </h3>
                
                <!-- é¢„è®¾é€‰é¡¹ -->
                <div id="options-container" class="space-y-3 mb-6">
                    <!-- åŠ¨æ€é€‰é¡¹å†…å®¹ -->
                </div>
                
                <!-- å¤šé€‰ç¡®è®¤æŒ‰é’® -->
                <div id="multi-confirm-container" class="hidden mb-6">
                    <button 
                        id="confirm-multi-btn"
                        onclick="confirmMultiSelection()"
                        class="w-full glass-button text-white py-3 rounded-xl font-medium hover:scale-[1.02] transition-all opacity-50 cursor-not-allowed font-serif text-sm"
                        disabled
                    >
                        ç¡®è®¤é€‰æ‹©
                    </button>
                </div>
                
                <!-- é¡µé¢åˆ‡æ¢æ ‡ç­¾ -->
                <div class="flex items-center justify-center space-x-6 mb-4">
                    <button 
                        id="tab-options" 
                        onclick="switchAnswerPage(0)"
                        class="px-4 py-2 rounded-xl font-medium transition-all font-serif text-sm relative text-white"
                    >
                        ä½ çš„é€‰æ‹©
                        <div class="absolute -bottom-1 left-0 right-0 h-0.5 bg-gradient-to-r from-aurora to-rose-glow transition-all duration-300"></div>
                    </button>
                    <button 
                        id="tab-custom" 
                        onclick="switchAnswerPage(1)"
                        class="px-4 py-2 rounded-xl font-medium transition-all font-serif text-sm relative text-white opacity-60"
                    >
                        ä½ çš„ä¸“å±ç­”æ¡ˆ
                        <div class="absolute -bottom-1 left-0 right-0 h-0 bg-gradient-to-r from-aurora to-rose-glow transition-all duration-300"></div>
                    </button>
                </div>
                
                <!-- é¡µé¢æŒ‡ç¤ºå™¨ -->
                <div class="flex justify-center space-x-2 mb-4">
                    <div class="page-indicator active" id="indicator-0"></div>
                    <div class="page-indicator" id="indicator-1"></div>
                </div>
                
                <!-- è‡ªå®šä¹‰ç­”æ¡ˆåŒºåŸŸ -->
                <div id="custom-answer-section" class="hidden">
                    <div class="space-y-4">
                        <label class="block text-gray-300 font-medium mb-3 flex items-center space-x-2 font-serif">
                            <span>âœ¨</span>
                            <span>ä½ çš„ä¸“å±ç­”æ¡ˆ</span>
                        </label>
                        <textarea 
                            id="custom-answer"
                            placeholder="å†™ä¸‹åªå±äºä½ ä»¬çš„ç­”æ¡ˆ..."
                            class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:border-aurora focus:outline-none focus:ring-2 focus:ring-aurora/20 transition-all resize-none h-24 font-serif"
                            oninput="toggleNextButton()"
                        ></textarea>
                        
                        <!-- æäº¤è‡ªå®šä¹‰ç­”æ¡ˆæŒ‰é’® -->
                        <button 
                            id="custom-submit-btn"
                            onclick="submitCustomAnswer()"
                            class="hidden w-full glass-button text-white py-3 rounded-xl font-medium hover:scale-[1.02] transition-all glow-effect font-serif"
                        >
                            ä¸‹ä¸€é¢˜ â†’
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- å¿ƒåŠ¨è¿›åº¦æ¡ -->
            <div class="mb-4">
                <div class="glass-card rounded-full p-3">
                    <div class="flex items-center justify-between text-xs text-gray-300 mb-1.5 font-serif">
                        <span id="progress-current-question">1</span>
                        <span class="gradient-text font-medium font-chinese">å¿ƒåŠ¨è¿›åº¦æ¡</span>
                        <span>/ 25</span>
                    </div>
                    <div class="w-full bg-black/30 rounded-full h-1.5">
                        <div id="progress-bar-display" class="bg-gradient-to-r from-aurora to-rose-glow h-1.5 rounded-full transition-all duration-500" style="width: 4%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- éŸ³ä¹æ§åˆ¶ -->
        <div class="fixed bottom-6 left-6 z-30">
            <button id="music-toggle" onclick="toggleMusic()" class="glass-card p-4 rounded-full hover:scale-105 transition-all">
                <span id="music-icon" class="text-2xl">ğŸµ</span>
            </button>
        </div>
    </div>

    <!-- æƒ…ä¹¦ç”Ÿæˆé¡µ -->
    <div id="result-page" class="hidden min-h-screen relative z-20 p-3 flex items-center justify-center transition-all duration-1000 overflow-y-auto">
        <div class="max-w-lg mx-auto w-full">
            <!-- ç½‘æ˜“äº‘é£æ ¼æƒ…ä¹¦å¡ç‰‡ -->
            <div id="love-letter-card" class="relative overflow-hidden shadow-2xl">
                <!-- ä¸»èƒŒæ™¯ -->
                <div class="absolute inset-0 bg-gradient-to-br from-cosmic via-nebula to-midnight opacity-90"></div>
                <!-- åŠ¨æ€é¢œè‰²èƒŒæ™¯å±‚ -->
                <div id="dynamic-bg" class="absolute inset-0 opacity-20 transition-all duration-1000"></div>
                
                <!-- ç»ç’ƒæ‹Ÿæ€å¡ç‰‡ -->
                <div class="relative glass-card rounded-3xl p-4 border-2 border-white/10 backdrop-blur-xl">
                    <!-- è£…é¥°æ€§å…‰æ•ˆ -->
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-aurora/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-rose-glow/50 to-transparent"></div>
                    
                    <!-- è§’è½è£…é¥° -->
                    <div class="absolute top-2 left-2 w-2 h-2 bg-aurora/30 rounded-full"></div>
                    <div class="absolute top-2 right-2 w-2 h-2 bg-rose-glow/30 rounded-full"></div>
                    <div class="absolute bottom-2 left-2 w-2 h-2 bg-pink-dream/30 rounded-full"></div>
                    <div class="absolute bottom-2 right-2 w-2 h-2 bg-aurora/30 rounded-full"></div>
                
                    <div class="flex flex-col space-y-4">
                        <!-- é¡¶éƒ¨ï¼šåœ†å½¢ç”»æ¡†å¤´åƒ -->
                        <div class="flex justify-center">
                            <div class="w-28 h-28 rounded-full relative overflow-hidden shadow-xl border-2 border-white/20 glass-card">
                                <!-- ç”¨æˆ·å¤´åƒå¡«æ»¡æ•´ä¸ªåœ†å½¢ -->
                                <img id="result-avatar" class="w-full h-full object-cover" src="" alt="å¤´åƒ">
                                
                                <!-- ç”»æ¡†å†…ä¾§è£…é¥° -->
                                <div class="absolute inset-0 rounded-full border border-white/10"></div>
                            </div>
                        </div>
                        
                        <!-- ä¸‹æ–¹ï¼šæƒ…ä¹¦å†…å®¹ -->
                        <div class="space-y-4 w-full">
                            <!-- æ ‡é¢˜ -->
                            <div class="space-y-2 text-center">
                                <h2 class="text-lg font-chinese gradient-text font-bold">ä½ å’Œ<span id="result-name"></span>çš„æµªæ¼«æƒ…è¯—</h2>
                                <p class="text-gray-300 text-xs font-serif font-light italic">åœ¨æ¯ä¸ªå¿ƒåŠ¨ç¬é—´ï¼Œè°±å†™ç€åªå±äºä½ ä»¬çš„çˆ±æƒ…è¯—ç¯‡</p>
                            </div>
                            
                            <!-- æƒ…ä¹¦å†…å®¹ -->
                            <div id="love-letter-content" class="space-y-3 text-gray-200 leading-relaxed font-serif text-sm">
                                <!-- åŠ¨æ€ç”Ÿæˆçš„æƒ…ä¹¦å†…å®¹ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="mt-4 flex flex-col space-y-2">
                        <button 
                            id="ai-story-btn"
                            onclick="generateAIStory()"
                            class="w-full px-4 py-2 glass-button text-white rounded-xl hover:scale-[1.02] transition-all font-medium font-serif text-sm glow-effect"
                        >
                            <span id="ai-btn-text">âœ¨ ä¹¦å†™ä½ ä»¬çš„ä¸“å±æ•…äº‹</span>
                            <div id="ai-loading" class="hidden flex items-center justify-center space-x-2">
                                <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
                                <span>åˆ›ä½œä¸­...</span>
                                <div class="w-3 h-3 bg-white rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                            </div>
                        </button>
                        
                        <button 
                            onclick="generateNewLetter()"
                            class="w-full px-4 py-2 glass-card border border-white/20 text-white rounded-xl hover:border-aurora/50 transition-all font-medium font-serif text-sm"
                        >
                            ğŸ² é‡æ–°ç”Ÿæˆ
                        </button>
                        
                        <button 
                            onclick="restartQuiz()"
                            class="w-full px-4 py-2 glass-card border border-white/20 text-white rounded-xl hover:border-rose-glow/50 transition-all font-medium font-serif text-sm"
                        >
                            ğŸ”„ é‡æ–°å¡«å†™
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¢„è§ˆæŒ‰é’® -->
    <button onclick="togglePreview()" class="fixed bottom-4 right-4 glass-button text-white px-3 py-2 rounded-lg font-medium hover:scale-105 transition-all z-40 shadow-lg font-serif text-sm">
        ğŸ”
    </button>

    <script>
        let currentPage = 'cover';
        let userName = '';
        let userAvatar = '';
        let quizAnswers = [];
        let currentQuestionIndex = 0;
        let selectedOptions = []; // ç”¨äºå¤šé€‰é¢˜
        let currentAnswerPage = 0; // å½“å‰ç­”æ¡ˆé¡µé¢ (0=é¢„è®¾é€‰é¡¹, 1=è‡ªå®šä¹‰ç­”æ¡ˆ)
        let aiStoryGenerated = false; // æ˜¯å¦å·²ç”ŸæˆAIæ•…äº‹

        // DeepSeek APIé…ç½® (è¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™…APIå¯†é’¥)
        const DEEPSEEK_API_KEY = 'your-deepseek-api-key-here'; // å®é™…ä½¿ç”¨æ—¶è¯·æ›¿æ¢
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';

        // é—®å·æ•°æ®
        const questions = [
            {
                id: 1,
                text: 'ä½ ä»¬"åƒè‹¹æœ"æ—¶ï¼Œæœ€å–œæ¬¢å“ªä¸ªåœ°ç‚¹ï¼Ÿ',
                options: [
                    'ä»–çš„åŠå…¬å®¤/ä¹¦æˆ¿',
                    'ç„å…³ç©¿è¡£é•œå‰', 
                    'å§å®¤å¤§åºŠ',
                    'å®¢å…æŸ”è½¯çš„æ¯›æ¯¯/æ²™å‘',
                    'åˆºæ¿€çš„å…¬å…±åœºæ‰€è¾¹ç¼˜ï¼ˆå¦‚åœ°ä¸‹è½¦åº“ã€å‡æœŸä½ ä»¬å­¦æ ¡çš„è¯¾æ¡Œä¸‹ï¼‰'
                ]
            },
            {
                id: 2,
                text: 'é€šå¸¸ï¼Œæ˜¯è°å…ˆæš—ç¤ºæƒ³"åƒè‹¹æœ"ï¼Ÿ',
                options: [
                    'ä»–ï¼ˆçœ¼ç¥å˜å¾—å¹½æ·±ï¼Œå¸¦ç€ä¸å®¹ç½®ç–‘ï¼‰',
                    'ä»–ï¼ˆç”¨æŒ‡å°–è‹¥æœ‰ä¼¼æ— åœ°åˆ’è¿‡ä½ çš„æ•æ„Ÿå¸¦ï¼Œå˜´è§’å™™ç€ç¬‘ï¼‰',
                    'ä»–ï¼ˆä»èƒŒåç¯æŠ±ä½ä½ ï¼Œä¸‹å·´æŠµåœ¨ä½ è‚©å¤´ï¼Œå‘¼å¸å˜æœ‰ç‚¹é‡ï¼‰',
                    'ä½ ï¼ˆæ•…æ„è¹­åˆ°ä»–æ€€é‡Œï¼Œä»–æ„£äº†ä¸€ä¸‹éšå³æ‰£ç´§ä½ çš„è…°ï¼‰',
                    'ä½ ï¼ˆä¸€ä¸ªçœ¼ç¥ï¼Œä»–å°±è¯»æ‡‚å¹¶åŒ–è¢«åŠ¨ä¸ºä¸»åŠ¨ï¼‰'
                ]
            },
            {
                id: 3,
                text: `åœ¨"åƒè‹¹æœ"å¼€å§‹å‰ï¼Œä»–æœ€å–œæ¬¢äº²å»/æŠšæ‘¸ä½ èº«ä½“çš„å“ªä¸ªæ•æ„Ÿå¸¦ï¼Ÿ`,
                options: [
                    'é¼»å°–',
                    'åè…°å‡¹é™·çš„å¼§åº¦',
                    'é¢ˆçª/é”éª¨',
                    'è´è¶éª¨',
                    'ä½ è€³å/å˜´è¾¹/çœ¼ä¸‹é‚£é¢—å°ç—£'
                ]
            },
            {
                id: 4,
                text: `ä½ æœ€å–œæ¬¢ä»–èº«ä½“çš„å“ªä¸ªéƒ¨ä½åœ¨"åƒè‹¹æœ"æ—¶å±•ç°çš„æ€§æ„Ÿï¼Ÿ`,
                options: [
                    'ä»–æ»šåŠ¨çš„å–‰ç»“å’Œå‹æŠ‘çš„ä½å–˜',
                    'æ‰‹è‡‚ç»·èµ·çš„é’ç­‹å’Œçˆ†å‘çš„åŠ›é‡æ„Ÿ',
                    'åèƒŒç»·ç´§å¦‚å¼“å¼¦çš„å®Œç¾è‚Œè‚‰çº¿æ¡',
                    'æ±—ç æ»‘è¿‡ä»–é”éª¨ã€èƒ¸è‚Œçš„è½¨è¿¹',
                    'ä»–å¹³æ—¶å†·é™è‡ªæŒçš„çœ¼ç¥å½»åº•å¤±æ§'
                ]
            },
            {
                id: 5,
                text: 'å‰æˆæ—¶ï¼Œæœ€è®©ä½ å¿ƒè·³å¤±è¡¡çš„ä¸€ä¸ªæ ‡å¿—æ€§å°åŠ¨ä½œæ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æ…¢æ¡æ–¯ç†è§£å¼€ä½ ä¸€é¢—çº½æ‰£ï¼Œçœ¼ç¥é”ä½ä½ ',
                    'æŒ‡å°–è‹¥æœ‰ä¼¼æ— åœ°åˆ’è¿‡ä½ çš„è…°çº¿æˆ–å¤§è…¿å†…ä¾§ï¼Œå¼•èµ·æˆ˜æ —',
                    'çªç„¶æŠŠä½ æŠ±ä¸Šæ¡Œå­ä¸Šï¼Œä¸ä»–å¹³è§†ï¼ŒåŒæ‰‹æ’‘åœ¨ä½ ä¸¤ä¾§',
                    'ç”¨ä»–çš„é¢†å¸¦è½»è½»è’™ä½ä½ çš„çœ¼ç›ï¼Œå‰¥å¤ºè§†è§‰',
                    'æ§ä½ä½ çš„è„¸ï¼Œæ‹‡æŒ‡æ‘©æŒ²ä½ çš„ä¸‹å”‡ï¼Œçœ¼ç¥æ¸©æŸ”å¾—èƒ½æººæ­»äºº'
                ]
            },
            {
                id: 6,
                text: `ä»–"å“å°è‹¹æœ"æ—¶ï¼Œä»–æŒ‡å°–æœ€è¿·æ‹ä½ èº«ä½“çš„å“ªä¸€å¤„ï¼Ÿ`,
                options: [
                    'è…°ä¾§ç»†è…»çš„è‚Œè‚¤ï¼Œä»¿ä½›ä¸€ç”¨åŠ›å°±ä¼šç•™ä¸‹æŒ‡ç—•',
                    'èƒ¸å‰çš„æŸ”è½¯æ›²çº¿ï¼Œæ€»åƒæ§ç€æ˜“ç¢çš„çå®èˆ¬å°å¿ƒç¿¼ç¿¼',
                    'å¤§è…¿å†…ä¾§çš„ç»·ç´§ï¼Œåœ¨ä»–æŒä¸‹éšç€æ¯æ¬¡è§¦ç¢°è½»è½»é¢¤åŠ¨',
                    'è„ŠèƒŒå…‰æ»‘çš„æ›²çº¿ï¼Œä¸€è·¯å‘ä¸‹æ¢ç´¢éšç§˜çš„è…°çª',
                    'åé¢ˆï¼Œä»¿ä½›çŒ›å…½å¼ä½çŒç‰©è¦å®³'
                ]
            },
            {
                id: 7,
                text: `ä»–"å“å°è‹¹æœ"æ—¶ï¼Œä½ æœ€æ¸…æ™°åœ°æ„Ÿè§‰åˆ°ä»–å­˜åœ¨çš„ç¬é—´æ˜¯ï¼Ÿ`,
                options: [
                    'ä»–æ»šçƒ«çš„å‘¼å¸å¸¦ç€ä½å–˜ï¼Œé‡é‡å–·åœ¨ä½ æ•æ„Ÿçš„é¢ˆçª/è€³å',
                    'ä»–å¸¦ç€è–„èŒ§çš„æŒ‡è…¹ï¼ˆæˆ–å†°å‡‰çš„æˆ’æŒ‡/è…•è¡¨ï¼‰æ“¦è¿‡ä½ å¨‡å«©çš„è‚Œè‚¤',
                    'ä»–å®½åšçš„èº«ä½“å®Œå…¨è¦†ç›–ä½ ï¼Œå°†ä½ ç¦é”¢åœ¨ä»–çš„æ°”æ¯ä¸ä½“æ¸©ä¸­',
                    'ä»–å‘¢å–ƒç€ä½ çš„åå­—ï¼Œä»¥ä¸€ç§å®£å‘Šä¸»æƒçš„æ–¹å¼å½»åº•å æœ‰',
                    'ä»–çš„çœ¼çœ¸ä¸€ç¬ä¸ç¬åœ°ç›¯ç€ä½ ï¼Œæ•æ‰ä½ æ¯ä¸€ä¸ªç»†å¾®è¡¨æƒ…'
                ]
            },
            {
                id: 8,
                text: 'ä»–åœ¨æœ€æ²‰è¿·çš„æ—¶åˆ»ï¼Œä¼šå’¬ç€ä½ çš„è€³æœµï¼Œç”¨æ²™å“‘çš„å£°éŸ³è¯´å‡ºä»€ä¹ˆè¯ï¼Ÿ',
                options: [
                    '"è¿™é‡Œ......ä»é‡Œåˆ°å¤–éƒ½åˆ»ä¸Šæˆ‘çš„åå­—äº†ã€‚"',
                    '"æ ‡è®°äº†ï¼Œè·‘ä¸æ‰äº†ã€‚"',
                    '"å®è´ï¼Œä½ é‡Œé¢......æ¯”æˆ‘æƒ³è±¡çš„è¿˜è¦è´ªåƒã€‚"',
                    '"å¥½çˆ±ä½ ......æ€ä¹ˆçˆ±ä½ éƒ½ä¸å¤Ÿ......æŠ±ç´§æˆ‘ï¼Œåˆ«æ¾å¼€ã€‚"',
                    '"......ä¸è®¸çœ‹åˆ«äººï¼åªå‡†æƒ³ç€æˆ‘ï¼"'
                ]
            },
            {
                id: 9,
                text: 'ä»–æœ€å–œæ¬¢ä½ èº«ä½“ç»™å‡ºå“ªç§å›åº”ï¼Ÿ',
                options: [
                    'éš¾è€åœ°æ‰­åŠ¨è…°è‚¢ï¼Œæ— æ„è¯†å¯»æ±‚æ›´å¤š',
                    'æŒ‡å°–æ·±æ·±é™·å…¥ä»–åèƒŒï¼Œç•™ä¸‹æŠ“ç—•',
                    'å¸¦ç€å“­è…”çš„å‘œå’½å’Œç ´ç¢çš„æ±‚é¥¶',
                    'ä¸»åŠ¨è¿åˆçš„æ‘†åŠ¨å’Œçƒ­æƒ…çš„å›å»',
                    'æ— æ„è¯†åœ°ç”¨å°è…¿å‹¾ç¼ ä»–çš„è…°ï¼Œæˆ–æ˜¯ç”¨è„¸é¢Šè¹­ä»–æ±—æ¹¿çš„èƒ¸è†›'
                ]
            },
            {
                id: 10,
                text: `åœ¨éå§å®¤çš„åœ°ç‚¹ï¼Œ"åƒè‹¹æœ"æœ‰ä»€ä¹ˆç‹¬ç‰¹çš„åˆºæ¿€å’Œä¹è¶£ï¼Ÿ`,
                options: [
                    'æµ´å®¤ï¼šé•œä¸­äº¤å çš„èº«å½±ï¼Œæ°¤æ°²æ°´æ±½ä¸­æœ¦èƒ§çš„æ€§æ„Ÿ',
                    'ä¹¦æˆ¿ï¼šä¸¥è‚ƒåœºæ‰€çš„èƒŒå¾·æ„Ÿï¼Œçº¸å¼ å£°ã€çš®é©æ¤…çš„è§¦æ„Ÿ',
                    'è½¦ä¸Šï¼šç‹­å°ç©ºé—´ï¼Œéšæ—¶éšåœ°å¯èƒ½è¢«å‘ç°çš„éšç§˜å¿«æ„Ÿ',
                    'å¨æˆ¿ï¼šå†°å‡‰å²›å°ï¼Œç©¿ç€ä»–çš„è¡¬è¡«åšæ—©é¤ï¼Œæƒ¹ä»–æ‹¦è…°æŠ±ä¸Š',
                    'é˜³å°ï¼šå¤œé£ä¹ ä¹ ï¼ŒåŸå¸‚ç¯ç«ä¸ºèƒŒæ™¯çš„æµªæ¼«'
                ]
            },
            // ç»§ç»­æ·»åŠ å…¶ä»–15é“é¢˜...
            {
                id: 11,
                text: 'ä»–æœ‰æ²¡æœ‰åœ¨æŸä¸ªæ„æƒ³ä¸åˆ°ç”šè‡³æœ‰ç‚¹å±é™©çš„åœ°ç‚¹ï¼Œçªç„¶å¯¹ä½ äº§ç”Ÿ"åƒè‹¹æœ"çš„å¼ºçƒˆæ¬²æœ›ï¼Ÿ',
                options: [
                    'å…¬å¸èŒ¶æ°´é—´ï¼ˆå€Ÿå£æŠŠä½ æ‹‰è¿›éš”é—´ï¼‰',
                    'æœ‹å‹èšä¼šçš„é˜³å°ï¼ˆå€Ÿç€å¤œè‰²çš„æ©æŠ¤ï¼Œæ‰‹ä¸å®‰åˆ†åœ°æ¸¸èµ°ï¼‰',
                    'å®‰é™çš„å›¾ä¹¦é¦†è§’è½ï¼ˆå‹ä½å£°éŸ³åœ¨ä½ è€³è¾¹è¯´éœ²éª¨çš„è¯ï¼Œçœ‹ä½ è„¸çº¢ï¼‰',
                    'æ‹¥æŒ¤çš„ç”µæ¢¯é‡Œï¼ˆç”¨èº«ä½“æŠ¤ä½ä½ ï¼Œä½å¤´ç”¨ç¼çƒ­çš„çœ¼ç¥çœ‹ä½ ï¼‰',
                    'æœ‹å‹èšé¤çš„æ´—æ‰‹é—´å¤–ï¼ˆæŠŠä½ å µåœ¨æ‹è§’ç´¢å»ï¼‰'
                ]
            },
            {
                id: 12,
                text: 'ä»–æ˜¯å¦æ›¾ç‰¹åˆ«ç—´è¿·åœ°"æ ‡è®°"ä½ èº«ä½“çš„æŸä¸ªå¹³æ—¶ä¸è¢«æ³¨æ„çš„éƒ¨ä½ï¼Ÿ',
                options: [
                    'è„šè¸ï¼ˆå–œæ¬¢æ¡åœ¨æŒä¸­,ç•™ä¸‹å»ç—•ï¼‰',
                    'è€³å‚ï¼ˆåå¤å®å¸è½»å’¬ï¼Œè®©ä½ æµ‘èº«å‘è½¯ï¼‰',
                    'è…°çªï¼ˆæŒ‡å°–æµè¿å¿˜è¿”ï¼Œæ¬£èµå®ƒçš„ç¾å¦™å‡¹é™·ï¼‰',
                    'æ‰‹æŒ‡ï¼ˆä¸€æ ¹æ ¹äº²å»å®å¸ï¼Œæƒ…è‰²åˆè™”è¯šï¼‰',
                    'è†ç›–å†…ä¾§ï¼ˆå‘ç°è¿™é‡Œçš„å¼‚å¸¸æ•æ„Ÿï¼Œä¹æ­¤ä¸ç–²åœ°æ¢ç´¢ï¼‰'
                ]
            },
            {
                id: 13,
                text: `å“ªç§è¡£ç‰©/é…é¥°åœ¨"åƒè‹¹æœ"æ—¶æœ€èƒ½åˆºæ¿€åˆ°ä»–/ä½ ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰`,
                options: [
                    'ä½ ï¼šç©¿ç€ä»–çš„å®½å¤§è¡¬è¡«',
                    'ä½ ï¼šä»…æˆ´ç€é¡¹é“¾',
                    'ä½ ï¼šè•¾ä¸é•¿ç­’è¢œ',
                    'ä»–ï¼šæ¾å®çš„é¢†å¸¦',
                    'ä»–ï¼šè§£å¼€å‡ é¢—æ‰£å­çš„è¡¬è¡«'
                ],
                multiSelect: true
            },
            {
                id: 14,
                text: 'ä»–ä¼šåœ¨ä½ ä¸»åŠ¨æ—¶ï¼Œç”¨ä»€ä¹ˆè¯é¼“åŠ±ä½ ï¼Ÿ',
                options: [
                    '"å®è´ä»Šå¤©è¿™ä¹ˆä¹–ï¼Ÿä¸»åŠ¨çš„æ ·å­......çœŸè®©äººæŠŠæŒä¸ä½ã€‚"',
                    '"å®è´å¥½æ£’ï¼Œå¯¹ï¼å°±è¿™æ ·ï¼åˆ«åœ......"',
                    '"å­¦å¾—å¾ˆå¿«å˜›......çœ‹æ¥å¹³æ—¶æ²¡å°‘å·å­¦ï¼Ÿ"',
                    '"åˆ«ç´§å¼ ï¼Œæ…¢æ…¢æ¥ï¼Œæˆ‘åœ¨å‘¢......ä½ å¾ˆç¾ã€‚"',
                    '"......å“¼ï¼Œè¿™ä¸æ˜¯åšå¾—å¾ˆå¥½å˜›ï¼"'
                ]
            },
            {
                id: 15,
                text: 'æ¸©å­˜æ—¶ï¼Œä»–æœ€å–œæ¬¢ç”¨å“ªä¸ªéƒ¨ä½çœ·æ‹åœ°è¹­ä½ èº«ä½“å“ªä¸ªåœ°æ–¹ï¼Ÿ',
                options: [
                    'ç”¨é¼»å°–è¹­ä½ æ±—æ¹¿çš„é¬“è§’/é¢ˆçª',
                    'è„¸é¢Šè´´ç€ä½ å¹³å¦çš„å°è…¹/èƒ¸å£',
                    'å˜´å”‡æµè¿åœ¨ä½ è‚©å¤´/é”éª¨ï¼Œè½»å•„æµ…å»',
                    'é¢å¤´ç›¸æŠµï¼Œå‘¼å¸äº¤è',
                    'ç”¨ä¸‹å·´ä¸Šçš„èƒ¡èŒ¬è½»è½»ç£¨è¹­ä½ æ•æ„Ÿçš„è‚©é¢ˆ'
                ]
            },
            {
                id: 16,
                text: 'å½“ä»–çœ‹ç€ä½ å› ä»–è€Œç»½æ”¾çš„æ¨¡æ ·ï¼Œä»–å†…å¿ƒæ·±å¤„æœ€å¼ºçƒˆçš„å¿µå¤´æ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    '"å¥¹æ˜¯æˆ‘çš„ï¼Œä»å¤´åˆ°è„šï¼Œä»èº«åˆ°å¿ƒï¼Œæ°¸ç”Ÿæ°¸ä¸–ã€‚"',
                    '"æƒ³æŠŠå¥¹æ‰è¿›éª¨è¡€é‡Œï¼Œä¸€åˆ»ä¹Ÿä¸åˆ†ç¦»ã€‚"',
                    '"è¿™æ¨¡æ ·......ç»å¯¹ã€ç»å¯¹ä¸è®¸ç¬¬äºŒä¸ªäººçœ‹åˆ°ï¼"',
                    '"æ€ä¹ˆçˆ±å¥¹éƒ½çˆ±ä¸å¤Ÿ......æƒ³æŠŠå…¨ä¸–ç•Œéƒ½ç»™å¥¹ã€‚"',
                    '"æ˜¯æˆ‘è®©å¥¹å˜æˆè¿™æ ·çš„......åªæœ‰æˆ‘èƒ½åšåˆ°ã€‚"'
                ]
            },
            {
                id: 17,
                text: 'äº‹åæ¸…ç†æ—¶ï¼Œä»–å“ªä¸ªä¸ç»æ„çš„å°åŠ¨ä½œè®©ä½ è§‰å¾—ç‰¹åˆ«æ¸©æŸ”/æ€§æ„Ÿï¼Ÿ',
                options: [
                    'ç”¨æ¸©çƒ­çš„æ¹¿æ¯›å·¾ä»”ç»†æ“¦æ‹­ä½ æ¯ä¸€å¯¸è‚Œè‚¤ï¼ŒåŠ¨ä½œè½»æŸ”',
                    'å¸®ä½ æŠŠæ±—æ¹¿çš„ä¹±å‘æ¸©æŸ”åœ°åˆ«åˆ°è€³åï¼ŒæŒ‡å°–åˆ’è¿‡è€³å»“',
                    'æ¡èµ·æ•£è½ä¸€åœ°çš„è¡£ç‰©ï¼Œç”šè‡³ç¬¨æ‹™åœ°è¯•å›¾å¸®ä½ ç©¿ä¸Š',
                    'çªç„¶å°†ä½ æ‰“æ¨ªæŠ±èµ·ï¼Œå¾„ç›´èµ°å‘æµ´å®¤æ¸…ç†',
                    'æ¸…ç†æ—¶ï¼ŒæŒ‡å°–è‹¥æœ‰ä¼¼æ— åœ°æ»‘è¿‡æ•æ„Ÿå¸¦ï¼Œå¼•èµ·ä½ ç»†å¾®é¢¤æŠ–'
                ]
            },
            {
                id: 18,
                text: 'è¿™æ—¶ä½ å¬åˆ°ä»–çš„å¿ƒè·³å£°ï¼Œæ„Ÿè§‰å¦‚ä½•ï¼Ÿ',
                options: [
                    'æ²‰ç¨³æœ‰åŠ›ï¼Œåƒå®‰æŠšçš„é¼“ç‚¹ï¼Œè®©ä½ æ— æ¯”å®‰å¿ƒ',
                    'ä¾ç„¶å¿«é€Ÿé¼“åŠ¨ï¼Œä¸ä½ ç´Šä¹±çš„å¿ƒè·³åŒé¢‘ï¼Œä»–ä¹Ÿæœªå¹³å¤',
                    'å’Œè‡ªå·±çš„å¿ƒè·³æ¸æ¸åŒæ­¥ï¼Œä»¿ä½›èä¸ºä¸€ä½“',
                    'æ˜¯ä¸–ç•Œä¸Šæœ€åŠ¨å¬çš„å£°éŸ³ï¼Œä»–å› ä½ è€Œå­˜åœ¨',
                    'æ¯ä¸€ä¸‹éƒ½åœ¨è¯‰è¯´ç€çˆ±æ„ï¼Œæ¯”ä»»ä½•æƒ…è¯éƒ½åŠ¨äºº'
                ]
            },
            {
                id: 19,
                text: 'åœ¨ä½™éŸµä¸­ï¼Œä»–æ— æ„é—´æµéœ²å‡ºçš„å“ªä¸ªå°ç»†èŠ‚æœ€è®©ä½ å¿ƒåŠ¨ï¼Ÿ',
                options: [
                    'ä¸€å£°æ»¡è¶³çš„ã€æ‚ é•¿çš„å¹æ¯ï¼Œåƒå¸ä¸‹æ‰€æœ‰é‡æ‹…',
                    'æ— æ„è¯†åœ°æŠŠç©ä½ çš„ä¸€ç¼•å¤´å‘ï¼Œç»•åœ¨æŒ‡å°–',
                    'å°†ä½ æ›´ç´§åœ°æ‚å‘æ€€é‡Œï¼Œä¸‹å·´æŠµåœ¨ä½ å‘é¡¶ï¼Œä»¿ä½›æ€•ä½ æ¶ˆå¤±',
                    'é—­ç€çœ¼ï¼Œå˜´è§’å´å¸¦ç€ä¸€ä¸é¤è¶³çš„ã€è¿‘ä¹å­©å­æ°”çš„å¾®ç¬‘',
                    'æ·±æ·±æœ›ç€ä½ ï¼Œçœ¼ç¥é‡Œæœ‰æœªé€€çš„æƒ…æ½®å’Œæµ“å¾—åŒ–ä¸å¼€çš„çˆ±æ„'
                ]
            },
            {
                id: 20,
                text: 'ä»–ä¼šä¸ä¼šåœ¨äº‹åçªç„¶å˜å¾—å¾ˆ......ï¼Ÿ',
                options: [
                    'ç²˜äººï¼ˆåƒå¤§å‹çŠ¬ä¸€æ ·è´´ç€ä½ ï¼Œç´¢è¦äº²å»æ‹¥æŠ±ï¼‰',
                    'è¯ç—¨ï¼ˆçªç„¶å¼€å§‹è¯´å¾ˆå¤šæƒ…è¯æˆ–æœªæ¥ç•…æƒ³ï¼‰',
                    'å›°å€¦ï¼ˆå¾ˆå¿«æ²‰æ²‰ç¡å»ï¼Œæ‰‹è‡‚è¿˜ç´§ç´§åœˆç€ä½ ï¼‰',
                    'è‹¥æœ‰æ‰€æ€ï¼ˆå®‰é™åœ°çœ‹ç€ä½ ï¼Œçœ¼ç¥æ·±é‚ƒï¼‰',
                    'é‡æ–°ç‡ƒèµ·å°ç«è‹—ï¼ˆæ‰‹åˆå¼€å§‹ä¸å®‰åˆ†......ï¼‰'
                ]
            },
            {
                id: 21,
                text: 'æœ‰æ²¡æœ‰ä¸€ä¸ªç‰¹åˆ«çš„"åƒè‹¹æœ"åœ°ç‚¹ï¼Œå¯¹ä½ ä»¬æœ‰ç‰¹åˆ«çš„è±¡å¾æ„ä¹‰ï¼Ÿ',
                options: [
                    'åˆæ¬¡çš„åœ°ç‚¹',
                    'æŸä¸ªé‡è¦çš„çºªå¿µæ—¥/äº‹ä»¶åçš„åœºæ‰€',
                    'ä¸€ä¸ªæ›¾æœ‰è¿‡äº‰æ‰§æˆ–è¯¯ä¼šï¼Œæœ€ç»ˆåœ¨æ­¤å’Œè§£å¹¶æ›´äº²å¯†çš„åœ°æ–¹',
                    'ä¸€ä¸ªæ¡ä»¶è‰°è‹¦ä½†å¿ƒé å¾—æœ€è¿‘çš„åœ°æ–¹',
                    'ä»£è¡¨"å®¶"çš„åœ°æ–¹'
                ]
            },
            {
                id: 22,
                text: 'åœ¨"åƒè‹¹æœ"è¿™ä»¶äº‹ä¸Šï¼Œä»–ç»™è¿‡ä½ æœ€æ·±åˆ»çš„å®‰å…¨æ„Ÿ/è¢«çè§†æ„Ÿæ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æ— è®ºå¤šæ¿€åŠ¨ï¼Œå§‹ç»ˆå…³æ³¨ä½ çš„æ„Ÿå—å’Œååº”ï¼ŒåŠæ—¶è°ƒæ•´',
                    'äº‹å‰äº‹åçš„æ¸…æ´ã€ç…§é¡¾äº²åŠ›äº²ä¸º',
                    'æ˜ç¡®è¡¨ç¤ºå¹¶å°Šé‡ä½ çš„æ‰€æœ‰ç•Œé™å’Œ"å®‰å…¨è¯"',
                    'åœ¨äº²å¯†ä¸­/åï¼Œåå¤ç”¨è¨€è¯­å’Œè¡ŒåŠ¨ç¡®è®¤"çˆ±ä½ "ã€"ä½ æ˜¯å”¯ä¸€çš„"',
                    'åœ¨ä½ å¿ƒæƒ…ä¸ä½³/ä¸é€‚æ—¶ï¼Œèƒ½ç«‹åˆ»åœä¸‹å¹¶è½¬ä¸ºçº¯ç²¹çš„æ‹¥æŠ±å®‰æ…°'
                ]
            },
            {
                id: 23,
                text: 'ä½ è§‰å¾—"åƒè‹¹æœ"è¿™ä»¶äº‹ï¼Œå¯¹ä½ ä»¬çš„å…³ç³»æ„å‘³ç€ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æœ€åŸå§‹ä¹Ÿæœ€æ·±åˆ»çš„çˆ±çš„è¯­è¨€',
                    'çµé­‚ä¸èº«ä½“çš„åŒé‡è”ç»“ï¼Œç¼ºä¸€ä¸å¯',
                    'ä»–å®£ç¤ºä¸»æƒå’Œç‹¬å çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯æˆ‘ç¡®è®¤å½’å±çš„æ–¹å¼',
                    'æ¢ç´¢å½¼æ­¤ã€è·å¾—æè‡´å¿«ä¹çš„ç§˜å¯†æ¸¸æˆ',
                    'ç–²æƒ«ä¸–ç•Œé‡Œå”¯ä¸€çš„é¿é£æ¸¯ï¼Œå¯ä»¥å……ç”µçš„åœ°æ–¹'
                ]
            },
            {
                id: 24,
                text: 'ç»å†è¿‡æ— æ•°æ¬¡"åƒè‹¹æœ"ï¼Œä½ ä»¬ä¹‹é—´æœ€çè´µçš„å˜åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ',
                options: [
                    'æ— è¨€çš„é»˜å¥‘ï¼Œä¸€ä¸ªçœ¼ç¥ã€ä¸€ä¸ªå‘¼å¸å°±çŸ¥é“å¯¹æ–¹æƒ³è¦ä»€ä¹ˆ',
                    'æè‡´çš„ä¿¡ä»»ï¼Œå°†èº«ä½“å’Œçµé­‚æœ€è„†å¼±çš„éƒ¨åˆ†å®Œå…¨äº¤ä»˜å¯¹æ–¹',
                    'æ— æ³•å‰²èˆçš„ç¾ç»Šï¼Œæ—©å·²è¶…è¶Šè‚‰ä½“æ¬¢æ„‰ï¼Œæˆä¸ºå½¼æ­¤ç”Ÿå‘½çš„ä¸€éƒ¨åˆ†',
                    'å…±åŒæ¢ç´¢çš„ä¹è¶£ï¼Œä¸æ–­å‘ç°æ–°çš„å¿«ä¹æ¨¡å¼å’Œå½¼æ­¤çš„æ•æ„Ÿç‚¹',
                    'ç»å¯¹çš„å®‰å¿ƒï¼ŒçŸ¥é“æ— è®ºä½•æ—¶ä½•åœ°ï¼Œå¯¹æ–¹éƒ½æ˜¯æœ€æ¸´æœ›å’Œæ¥çº³è‡ªå·±çš„äºº'
                ]
            },
            {
                id: 25,
                text: 'å¦‚æœä½ ä»¬çš„çˆ±æƒ…æœ‰ä¸€ç§ä¸“å±çš„"è‹¹æœé¦™æ°”"ï¼Œå®ƒä¼šæ˜¯ä»€ä¹ˆå‘³é“ï¼Ÿ',
                options: [
                    'çƒˆé…’æ··åˆæ¸…ç”œæœé¦™',
                    'é›ªæ¾ä¸æ¸©æš–çš„ç¥ç€',
                    'é›¨åé’è‰ä¸é˜³å…‰çš„å‘³é“',
                    'æµ“éƒçš„é»‘å·§å…‹åŠ›ä¸è¯±äººçº¢é…’é¦™',
                    'æµ·é£å’¸æ¶©ä¸é¦™æ©™çš„é…¸ç”œ'
                ]
            }
        ];

        // åˆ‡æ¢é¢„è§ˆæ¨¡å¼
        function togglePreview() {
            const preview = document.getElementById('preview-mode');
            preview.classList.toggle('hidden');
        }

        // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
        function showPage(page) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('[id$="-page"]').forEach(p => p.classList.add('hidden'));
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(page + '-page').classList.remove('hidden');
            currentPage = page;
            
            // å¦‚æœåˆ‡æ¢åˆ°é—®å·é¡µï¼Œæ˜¾ç¤ºå¤´åƒ
            if (page === 'quiz' && userAvatar) {
                document.getElementById('quiz-avatar-img').src = userAvatar;
                document.getElementById('quiz-avatar').classList.remove('hidden');
            }
        }

        // ä¸‹ä¸€é¡µ
        function nextPage() {
            if (currentPage === 'cover') {
                showPage('input');
            }
        }

        // åˆ‡æ¢ç­”æ¡ˆé¡µé¢
        function switchAnswerPage(pageIndex) {
            currentAnswerPage = pageIndex;
            const customSection = document.getElementById('custom-answer-section');
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            const tabOptions = document.getElementById('tab-options');
            const tabCustom = document.getElementById('tab-custom');
            const indicatorOptions = document.getElementById('indicator-0');
            const indicatorCustom = document.getElementById('indicator-1');
            
            if (pageIndex === 0) {
                // é¢„è®¾é€‰é¡¹é¡µé¢
                customSection.classList.add('hidden');
                
                tabOptions.classList.remove('opacity-60');
                tabOptions.classList.add('text-white');
                tabOptions.querySelector('div').classList.remove('h-0');
                tabOptions.querySelector('div').classList.add('h-0.5');
                
                tabCustom.classList.add('opacity-60');
                tabCustom.classList.add('text-white');
                tabCustom.querySelector('div').classList.add('h-0');
                tabCustom.querySelector('div').classList.remove('h-0.5');
                
                indicatorOptions.classList.add('active');
                indicatorCustom.classList.remove('active');
            } else {
                // è‡ªå®šä¹‰ç­”æ¡ˆé¡µé¢
                customSection.classList.remove('hidden');
                
                tabCustom.classList.remove('opacity-60');
                tabCustom.classList.add('text-white');
                tabCustom.querySelector('div').classList.remove('h-0');
                tabCustom.querySelector('div').classList.add('h-0.5');
                
                tabOptions.classList.add('opacity-60');
                tabOptions.classList.add('text-white');
                tabOptions.querySelector('div').classList.add('h-0');
                tabOptions.querySelector('div').classList.remove('h-0.5');
                
                indicatorCustom.classList.add('active');
                indicatorOptions.classList.remove('active');
            }
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    userAvatar = e.target.result;
                    // æ˜¾ç¤ºå¤´åƒ
                    const avatarImg = document.getElementById('uploaded-avatar');
                    avatarImg.src = userAvatar;
                    document.getElementById('avatar-area').classList.remove('hidden');
                    
                    checkInputComplete();
                };
                reader.readAsDataURL(file);
            }
        }

        // æ£€æŸ¥è¾“å…¥æ˜¯å¦å®Œæ•´
        function checkInputComplete() {
            const name = document.getElementById('userName').value.trim();
            const photo = userAvatar;
            const btn = document.getElementById('start-quiz-btn');
            
            if (name && photo) {
                btn.disabled = false;
                btn.classList.add('glow-effect');
            } else {
                btn.disabled = true;
                btn.classList.remove('glow-effect');
            }
        }

        // å¼€å§‹é—®å·
        function startQuiz() {
            userName = document.getElementById('userName').value.trim();
            showPage('quiz');
            displayQuestion(0);
        }

        // æ˜¾ç¤ºé—®é¢˜
        function displayQuestion(index) {
            if (index >= questions.length) {
                // é—®å·å®Œæˆï¼Œè·³è½¬åˆ°ç»“æœé¡µ
                generateLoveLetter();
                return;
            }

            currentQuestionIndex = index;
            const question = questions[index];
            
            // é‡ç½®é€‰æ‹©çŠ¶æ€
            selectedOptions = [];
            currentAnswerPage = 0;
            
            // æ›´æ–°é—®é¢˜ç¼–å·å’Œè¿›åº¦
            document.getElementById('progress-current-question').textContent = index + 1;
            document.getElementById('progress-bar-display').style.width = `${((index + 1) / questions.length * 100)}%`;
            
            // æ›´æ–°é—®é¢˜æ–‡æœ¬ï¼ŒåŠ¨æ€æ’å…¥å§“å
            let questionText = question.text.replace(/mjg/g, userName);
            
            // å¤„ç†"ä»–"çš„æ›¿æ¢ï¼šæ¯ä¸ªé—®é¢˜ç‹¬ç«‹è®¡ç®—ï¼Œç¬¬ä¸€æ¬¡å‡ºç°æ›¿æ¢ä¸ºç”¨æˆ·åï¼Œç¬¬äºŒæ¬¡ä¿æŒ"ä»–"
            const heRegex = /ä»–/g;
            let heCount = 0;
            questionText = questionText.replace(heRegex, (match) => {
                heCount++;
                return heCount === 1 ? userName : 'ä»–';
            });
            
            document.getElementById('question-text').textContent = questionText;
            
            // æ¸…ç©ºå¹¶é‡æ–°ç”Ÿæˆé€‰é¡¹
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, optionIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'glass-card rounded-xl p-3 cursor-pointer hover:border-aurora/50 transition-all group';
                
                // å¤„ç†é€‰é¡¹æ–‡æœ¬ä¸­çš„æ‹¬å·å†…å®¹
                const formattedOption = formatOptionText(option);
                
                optionDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-5 h-5 ${question.multiSelect ? 'rounded-md' : 'rounded-full'} border-2 border-white/30 flex-shrink-0 mt-0.5 group-hover:border-aurora transition-all flex items-center justify-center">
                            ${question.multiSelect ? '<div class="hidden w-2.5 h-2.5 bg-aurora rounded-sm"></div>' : ''}
                        </div>
                        <div class="text-gray-200 group-hover:text-white transition-all font-serif text-sm leading-snug">${formattedOption}</div>
                    </div>
                `;
                
                if (question.multiSelect) {
                    optionDiv.onclick = () => toggleMultiOption(optionIndex, option, optionDiv);
                } else {
                    optionDiv.onclick = () => selectOption(optionIndex, option, optionDiv);
                }
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // å¤„ç†å¤šé€‰é¢˜ç¡®è®¤æŒ‰é’®
            const multiConfirmContainer = document.getElementById('multi-confirm-container');
            if (question.multiSelect) {
                multiConfirmContainer.classList.remove('hidden');
                const confirmBtn = document.getElementById('confirm-multi-btn');
                confirmBtn.disabled = true;
                confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                confirmBtn.classList.remove('glow-effect');
            } else {
                multiConfirmContainer.classList.add('hidden');
            }
            
            // é‡ç½®ç­”æ¡ˆé¡µé¢åˆ°é¢„è®¾é€‰é¡¹
            switchAnswerPage(0);
            
            // æ¸…ç©ºè‡ªå®šä¹‰ç­”æ¡ˆ
            document.getElementById('custom-answer').value = '';
            const customBtn = document.getElementById('custom-submit-btn');
            if (customBtn) customBtn.classList.add('hidden');
        }

        // å¤šé€‰é¢˜é€‰é¡¹åˆ‡æ¢
        function toggleMultiOption(index, text, element) {
            const checkbox = element.querySelector('.w-5 > div');
            const isSelected = selectedOptions.includes(index);
            
            if (isSelected) {
                // å–æ¶ˆé€‰æ‹©
                selectedOptions = selectedOptions.filter(i => i !== index);
                element.classList.remove('bg-aurora/20', 'border-aurora');
                if (checkbox) checkbox.classList.add('hidden');
            } else {
                // æ·»åŠ é€‰æ‹©
                selectedOptions.push(index);
                element.classList.add('bg-aurora/20', 'border-aurora');
                if (checkbox) checkbox.classList.remove('hidden');
            }
            
            // æ›´æ–°ç¡®è®¤æŒ‰é’®çŠ¶æ€
            const confirmBtn = document.getElementById('confirm-multi-btn');
            if (confirmBtn) {
                if (selectedOptions.length > 0) {
                    confirmBtn.disabled = false;
                    confirmBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    confirmBtn.classList.add('glow-effect');
                } else {
                    confirmBtn.disabled = true;
                    confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    confirmBtn.classList.remove('glow-effect');
                }
            }
        }

        // ç¡®è®¤å¤šé€‰ç­”æ¡ˆ
        function confirmMultiSelection() {
            const question = questions[currentQuestionIndex];
            const selectedTexts = selectedOptions.map(index => question.options[index]);
            const customAnswer = document.getElementById('custom-answer').value.trim();
            
            quizAnswers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: selectedTexts,
                customAnswer: customAnswer,
                questionText: question.text,
                multiSelect: true
            };
            
            // è·³è½¬åˆ°ä¸‹ä¸€é¢˜
            setTimeout(() => {
                displayQuestion(currentQuestionIndex + 1);
            }, 500);
        }

        // æ ¼å¼åŒ–é€‰é¡¹æ–‡æœ¬ï¼Œå¤„ç†æ‹¬å·å†…å®¹
        function formatOptionText(text) {
            return text.replace(/ï¼ˆ([^ï¼‰]*)ï¼‰/g, '<span class="text-sm text-gray-400 font-light">ï¼ˆ$1ï¼‰</span>');
        }

        // åˆ‡æ¢è‡ªå®šä¹‰ç­”æ¡ˆæŒ‰é’®æ˜¾ç¤º
        function toggleNextButton() {
            const customAnswer = document.getElementById('custom-answer').value.trim();
            const customBtn = document.getElementById('custom-submit-btn');
            
            if (customBtn) {
                if (customAnswer) {
                    customBtn.classList.remove('hidden');
                } else {
                    customBtn.classList.add('hidden');
                }
            }
        }

        // æäº¤è‡ªå®šä¹‰ç­”æ¡ˆ
        function submitCustomAnswer() {
            const customAnswer = document.getElementById('custom-answer').value.trim();
            const question = questions[currentQuestionIndex];
            
            // ä¿å­˜è‡ªå®šä¹‰ç­”æ¡ˆ
            quizAnswers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: question.multiSelect ? selectedOptions.map(index => question.options[index]) : null,
                customAnswer: customAnswer,
                questionText: question.text,
                multiSelect: question.multiSelect || false
            };
            
            // è·³è½¬åˆ°ä¸‹ä¸€é¢˜
            displayQuestion(currentQuestionIndex + 1);
        }

        // é€‰æ‹©é€‰é¡¹ï¼ˆå•é€‰é¢˜ï¼‰
        function selectOption(index, text, element) {
            const question = questions[currentQuestionIndex];
            
            // å¦‚æœæ˜¯å¤šé€‰é¢˜ï¼Œä¸å¤„ç†
            if (question.multiSelect) return;
            
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('#options-container > div').forEach(div => {
                div.classList.remove('bg-aurora/20', 'border-aurora');
                const circle = div.querySelector('.w-5');
                if (circle) circle.classList.remove('bg-aurora');
            });
            
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            element.classList.add('bg-aurora/20', 'border-aurora');
            const circle = element.querySelector('.w-5');
            if (circle) circle.classList.add('bg-aurora');
            
            // ä¿å­˜ç­”æ¡ˆ
            const customAnswer = document.getElementById('custom-answer').value.trim();
            quizAnswers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: text,
                customAnswer: customAnswer,
                questionText: question.text
            };
            
            // å»¶è¿Ÿè·³è½¬åˆ°ä¸‹ä¸€é¢˜
            setTimeout(() => {
                displayQuestion(currentQuestionIndex + 1);
            }, 800);
        }

        // éŸ³ä¹æ§åˆ¶
        function toggleMusic() {
            const audio = document.getElementById('background-music');
            const icon = document.getElementById('music-icon');
            
            if (isPlaying) {
                audio.pause();
                icon.textContent = 'ğŸµ';
                isPlaying = false;
            } else {
                playBackgroundMusic();
            }
        }

        function playBackgroundMusic() {
            const audio = document.getElementById('background-music');
            const icon = document.getElementById('music-icon');
            
            // ç”±äºæµè§ˆå™¨é™åˆ¶ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾
            audio.play().then(() => {
                isPlaying = true;
                icon.textContent = 'ğŸ¶';
            }).catch((error) => {
                console.log('éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:', error);
                icon.textContent = 'ğŸ”‡';
            });
        }

        // ç”Ÿæˆæƒ…ä¹¦
        function generateLoveLetter() {
            showPage('result');
            
            // è®¾ç½®å¤´åƒå’Œå§“å
            document.getElementById('result-avatar').src = userAvatar;
            document.getElementById('result-name').textContent = userName;
            
            // æå–å›¾ç‰‡ä¸»è‰²è°ƒå¹¶åº”ç”¨èƒŒæ™¯
            if (userAvatar) {
                extractDominantColorAndApplyBackground(userAvatar);
            }
            
            // ç”Ÿæˆæƒ…ä¹¦å†…å®¹
            createLoveLetterContent();
        }

        // æå–å›¾ç‰‡ä¸»è‰²è°ƒå¹¶åº”ç”¨èƒŒæ™¯
        function extractDominantColorAndApplyBackground(imageSrc) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // è®¾ç½®canvaså¤§å°
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // ç»˜åˆ¶å›¾åƒ
                    ctx.drawImage(img, 0, 0);
                    
                    // è·å–å›¾åƒæ•°æ®
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    // è®¡ç®—ä¸»è‰²è°ƒ
                    const colorCount = {};
                    const step = 20; // é‡‡æ ·æ­¥é•¿ï¼Œæé«˜æ€§èƒ½
                    
                    for (let i = 0; i < data.length; i += step * 4) {
                        const r = Math.round(data[i] / 32) * 32;
                        const g = Math.round(data[i + 1] / 32) * 32;
                        const b = Math.round(data[i + 2] / 32) * 32;
                        const alpha = data[i + 3];
                        
                        if (alpha > 125) { // å¿½ç•¥é€æ˜åƒç´ 
                            const color = `${r},${g},${b}`;
                            colorCount[color] = (colorCount[color] || 0) + 1;
                        }
                    }
                    
                    // æ‰¾å‡ºæœ€å¸¸è§çš„é¢œè‰²
                    let dominantColor = '233,30,99'; // é»˜è®¤auroraè‰²
                    let maxCount = 0;
                    
                    for (const color in colorCount) {
                        if (colorCount[color] > maxCount) {
                            maxCount = colorCount[color];
                            dominantColor = color;
                        }
                    }
                    
                    // åº”ç”¨åˆ°èƒŒæ™¯
                    applyDynamicBackground(dominantColor);
                    
                } catch (error) {
                    console.log('é¢œè‰²æå–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è‰²å½©:', error);
                    applyDynamicBackground('233,30,99'); // ä½¿ç”¨é»˜è®¤auroraè‰²
                }
            };
            
            img.onerror = function() {
                console.log('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è‰²å½©');
                applyDynamicBackground('233,30,99');
            };
            
            img.src = imageSrc;
        }

        // åº”ç”¨åŠ¨æ€èƒŒæ™¯è‰²
        function applyDynamicBackground(rgbColor) {
            const dynamicBg = document.getElementById('dynamic-bg');
            if (dynamicBg) {
                // åˆ›å»ºåŸºäºä¸»è‰²è°ƒçš„æ¸å˜
                const gradient = `linear-gradient(135deg, 
                    rgba(${rgbColor}, 0.3) 0%, 
                    rgba(${rgbColor}, 0.1) 50%, 
                    rgba(${rgbColor}, 0.2) 100%)`;
                
                dynamicBg.style.background = gradient;
                
                // åŒæ—¶æ›´æ–°é¡µé¢æ•´ä½“èƒŒæ™¯
                const resultPage = document.getElementById('result-page');
                resultPage.style.background = `radial-gradient(ellipse at center, rgba(${rgbColor}, 0.1) 0%, rgba(26, 26, 46, 0.9) 100%)`;
            }
        }

        // åˆ›å»ºæƒ…ä¹¦å†…å®¹
        function createLoveLetterContent() {
            // è¿‡æ»¤æœ‰æ•ˆç­”æ¡ˆï¼ˆæœ‰é€‰æ‹©æˆ–è‡ªå®šä¹‰å›ç­”çš„ï¼‰
            const validAnswers = quizAnswers.filter(answer => 
                (answer.selectedOption && answer.selectedOption.length > 0) || 
                (answer.customAnswer && answer.customAnswer.trim())
            );
            
            // éšæœºé€‰æ‹©3ä¸ªé—®ç­”
            const selectedAnswers = getRandomItems(validAnswers, 3);
            
            // ç”Ÿæˆæƒ…ä¹¦æ®µè½
            const letterContent = document.getElementById('love-letter-content');
            letterContent.innerHTML = '';
            
            selectedAnswers.forEach((answer, index) => {
                const paragraph = createLoveLetterParagraph(answer, index);
                letterContent.appendChild(paragraph);
            });
        }

        // åˆ›å»ºæƒ…ä¹¦æ®µè½
        function createLoveLetterParagraph(answer, index) {
            const div = document.createElement('div');
            div.className = 'relative group mb-3';
            
            // ä¸»å†…å®¹å®¹å™¨ - ç»ç’ƒæ‹Ÿæ€æ–¹æ¡†
            const contentBox = document.createElement('div');
            contentBox.className = 'relative backdrop-blur-xl bg-white/5 border border-white/10 rounded-xl p-3 shadow-lg';
            
            // å€’å½±æ•ˆæœ
            const reflection = document.createElement('div');
            reflection.className = 'absolute top-full left-0 right-0 h-full backdrop-blur-xl bg-white/2 border border-white/5 rounded-xl opacity-20 transform scale-y-[-1] translate-y-1 pointer-events-none';
            reflection.style.maskImage = 'linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, transparent 60%)';
            reflection.style.webkitMaskImage = 'linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, transparent 60%)';
            
            // è½¬æ¢é—®é¢˜ä¸ºæƒ…ä¹¦è¯­å¥
            let letterText = '';
            const questionText = answer.questionText.replace(/mjg/g, userName);
            
            // ä½¿ç”¨è‡ªå®šä¹‰ç­”æ¡ˆä¼˜å…ˆï¼Œå¦åˆ™ä½¿ç”¨é€‰é¡¹
            const userResponse = answer.customAnswer && answer.customAnswer.trim() 
                ? answer.customAnswer 
                : (Array.isArray(answer.selectedOption) 
                    ? answer.selectedOption.join('ï¼Œ') 
                    : answer.selectedOption);
            
            if (userResponse) {
                letterText = convertToLoveLetter(questionText, userResponse, userName, answer.questionId);
                // å°†æƒ…ä¹¦å†…å®¹ä¸­çš„"ä»–"æ›¿æ¢ä¸ºç”¨æˆ·åå­—
                letterText = letterText.replace(/ä»–/g, userName);
            }
            
            contentBox.innerHTML = `
                <div class="flex items-center space-x-2 mb-2">
                    <div class="w-4 h-4 rounded-full bg-gradient-to-r from-pink-400/60 to-rose-400/60 flex items-center justify-center shadow-sm backdrop-blur-sm">
                        <span class="text-white text-xs font-bold">${index + 1}</span>
                    </div>
                    <p class="text-gray-400 italic text-xs font-serif opacity-80">ç¬¬${index + 1}ç« </p>
                </div>
                <p class="text-gray-100 leading-relaxed text-sm font-serif group-hover:text-white transition-colors duration-300">${letterText}</p>
            `;
            
            // ç»„è£…å…ƒç´ 
            div.appendChild(contentBox);
            div.appendChild(reflection);
            
            return div;
        }

        // å°†é—®ç­”è½¬æ¢ä¸ºæƒ…ä¹¦è¯­å¥ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        function convertToLoveLetter(question, answer, name, questionId) {
            // ç‰¹æ®Šå¤„ç†ç¬¬äºŒé—®ï¼šä½¿ç”¨"çš„æ˜¯"è¿æ¥
            if (questionId === 2) {
                let processedQuestion = question
                    .replace(/[ï¼Ÿ?]/g, '') // ç§»é™¤é—®å·
                    .replace(/æ˜¯è°/g, '') // ç§»é™¤"æ˜¯è°"
                    .replace(/è°/g, '') // ç§»é™¤"è°"
                    .trim();
                return `${processedQuestion}çš„æ˜¯${answer}ã€‚`;
            }
            
            // ç§»é™¤é—®å·å’Œç–‘é—®è¯ï¼Œç„¶åè¿æ¥ç­”æ¡ˆ
            let processedQuestion = question
                .replace(/[ï¼Ÿ?]/g, '') // ç§»é™¤é—®å·
                .replace(/æ˜¯å¦/g, '') // ç§»é™¤"æ˜¯å¦"
                .replace(/ä»€ä¹ˆ\w*/g, '') // ç§»é™¤"ä»€ä¹ˆXXX"ç–‘é—®è¯
                .replace(/å“ªä¸ª\w*/g, '') // ç§»é™¤"å“ªä¸ªXXX"ç–‘é—®è¯
                .replace(/å“ªç§\w*/g, '') // ç§»é™¤"å“ªç§XXX"ç–‘é—®è¯
                .replace(/å“ªé‡Œ\w*/g, '') // ç§»é™¤"å“ªé‡ŒXXX"ç–‘é—®è¯
                .replace(/æ€ä¹ˆ\w*/g, '') // ç§»é™¤"æ€ä¹ˆXXX"ç–‘é—®è¯
                .replace(/å¦‚ä½•\w*/g, '') // ç§»é™¤"å¦‚ä½•XXX"ç–‘é—®è¯
                .replace(/æ—¶$/g, '') // ç§»é™¤ç»“å°¾çš„"æ—¶"
                .replace(/å—$/g, '') // ç§»é™¤ç»“å°¾çš„"å—"
                .replace(/å‘¢$/g, '') // ç§»é™¤ç»“å°¾çš„"å‘¢"
                .trim();
            
            // æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦æ·»åŠ "æ˜¯"æ¥å¢å¼ºé€»è¾‘æ€§
            const needsLogicalConnection = (processedQuestion, answer) => {
                // å¦‚æœé—®é¢˜å·²ç»åŒ…å«æ˜ç¡®çš„åŠ¨è¯æˆ–å®Œæ•´çš„å¥å­ç»“æ„ï¼Œåˆ™ä¸éœ€è¦"æ˜¯"
                const hasVerb = /ä¼š|èƒ½|å–œæ¬¢|æ„Ÿè§‰|å¬åˆ°|çœ‹åˆ°|æƒ³|è§‰å¾—|ç»™|ç”¨|å¸®|è®©|æŠŠ|å°†|å˜|æˆ|åš|è¯´|å‘Šè¯‰|è¡¨ç¤º|ç¡®è®¤|å¼€å§‹|ç»“æŸ|å®Œæˆ|è¿›è¡Œ|å‘ç”Ÿ|å‡ºç°|å­˜åœ¨|å±äº|æ„å‘³ç€|ä»£è¡¨|è±¡å¾|ä½“ç°|åæ˜ |è¡¨è¾¾|ä¼ è¾¾|æ˜¾ç¤º|å±•ç°|å‘ˆç°|è¡¨æ˜|è¯æ˜|è¯´æ˜|æŒ‡å‡º|å¼ºè°ƒ|çªå‡º|é‡ç‚¹|å…³é”®|æ ¸å¿ƒ|æœ¬è´¨|æ ¹æœ¬|åŸºç¡€|ä¸»è¦|é‡è¦|ç‰¹åˆ«|ç‰¹æ®Š|ç‹¬ç‰¹|å”¯ä¸€|ä¸“é—¨|ä¸“å±|ä¸ªäºº|ç§äºº|ç§˜å¯†|éšç§|å†…å¿ƒ|æ·±å¤„|æœ€|æ›´|éå¸¸|ç‰¹åˆ«|æ ¼å¤–|å°¤å…¶|ç‰¹åœ°|ä¸“é—¨|æ•…æ„|æœ‰æ„|æ— æ„|ä¸ç»æ„|çªç„¶|ç¬é—´|ç«‹åˆ»|é©¬ä¸Š|éšå³|æ¥ç€|ç„¶å|æœ€å|ç»ˆäº|æ€»æ˜¯|ç»å¸¸|å¶å°”|æœ‰æ—¶|æ›¾ç»|å·²ç»|æ­£åœ¨|å³å°†|å‡†å¤‡|å¼€å§‹|ç»§ç»­|åœæ­¢|ç»“æŸ|å®Œæˆ|è¾¾åˆ°|å®ç°|è·å¾—|å¾—åˆ°|æ”¶åˆ°|æ¥å—|æ‹’ç»|åŒæ„|åå¯¹|æ”¯æŒ|èµæˆ|å–œæ¬¢|è®¨åŒ|çˆ±|æ¨|æƒ³è¦|éœ€è¦|å¸Œæœ›|æœŸæœ›|æ‹…å¿ƒ|å®³æ€•|ç´§å¼ |å…´å¥‹|å¼€å¿ƒ|éš¾è¿‡|ç”Ÿæ°”|æ„¤æ€’|æ„ŸåŠ¨|éœ‡æ’¼|æƒŠè®¶|æƒŠå–œ|å¤±æœ›|æ²®ä¸§|ç„¦è™‘|ç´§å¼ |æ”¾æ¾|èˆ’æœ|èˆ’é€‚|æ¸©æš–|å‡‰çˆ½|çƒ­|å†·|ç–¼|ç—›|èˆ’æœ|ä¸èˆ’æœ|éš¾å—|éš¾è¿‡|å¼€å¿ƒ|é«˜å…´|å¿«ä¹|å¹¸ç¦|æ»¡è¶³|æ»¡æ„|ä¸æ»¡|æŠ±æ€¨|è¡¨æ‰¬|èµç¾|æ‰¹è¯„|æŒ‡è´£|è´£æ€ª|åŸè°…|é“æ­‰|æ„Ÿè°¢|æŠ¥ç­”|å›æŠ¥|å¥–åŠ±|æƒ©ç½š|å¤„ç½š|ä¿æŠ¤|ç…§é¡¾|å…³å¿ƒ|å…³æ³¨|æ³¨æ„|å¿½è§†|å¿½ç•¥|é—å¿˜|è®°ä½|å›å¿†|æƒ³èµ·|è”æƒ³|è”ç³»|å…³è”|ç›¸å…³|æ— å…³|æœ‰å…³|æ¶‰åŠ|åŒ…å«|åŒ…æ‹¬|æ¶µç›–|è¦†ç›–|å»¶ä¼¸|æ‰©å±•|ç¼©å°|å‡å°‘|å¢åŠ |æé«˜|é™ä½|æ”¹å–„|æ”¹è¿›|æ”¹å˜|å˜åŒ–|è½¬å˜|è½¬æ¢|äº¤æ¢|æ›¿æ¢|ä»£æ›¿|å–ä»£|è¡¥å……|æ·»åŠ |åˆ é™¤|ç§»é™¤|å»é™¤|æ¶ˆé™¤|æ¸…é™¤|æ¸…ç†|æ•´ç†|æ”¶æ‹¾|å‡†å¤‡|å®‰æ’|è®¡åˆ’|è®¾è®¡|åˆ›é€ |åˆ›å»º|å»ºç«‹|æ„å»º|ç»„ç»‡|ç®¡ç†|æ§åˆ¶|æ“ä½œ|ä½¿ç”¨|åˆ©ç”¨|è¿ç”¨|åº”ç”¨|é‡‡ç”¨|é€‰æ‹©|å†³å®š|åˆ¤æ–­|è€ƒè™‘|æ€è€ƒ|æƒ³è±¡|å¹»æƒ³|æ¢¦æƒ³|å®ç°|è¾¾æˆ|å®Œæˆ|è§£å†³|å¤„ç†|é¢å¯¹|åº”å¯¹|å…‹æœ|æˆ˜èƒœ|å¤±è´¥|æˆåŠŸ|èƒœåˆ©|å¤±è´¥|è¾“|èµ¢|è·èƒœ|å–èƒœ|å ä¼˜|é¢†å…ˆ|è½å|è¿½èµ¶|è¶…è¶Š|è¶…è¿‡|è¾¾åˆ°|åˆ°è¾¾|æŠµè¾¾|æ¥åˆ°|å»åˆ°|ç¦»å¼€|å‡ºå‘|å¯ç¨‹|å›æ¥|è¿”å›|å›åˆ°|æ¥è‡ª|ä»|åˆ°|å‘|æœ|å¾€|å»|æ¥|ä¸Š|ä¸‹|å·¦|å³|å‰|å|å†…|å¤–|é‡Œ|å¤–é¢|é‡Œé¢|ä¸Šé¢|ä¸‹é¢|å‰é¢|åé¢|å·¦è¾¹|å³è¾¹|ä¸­é—´|ä¹‹é—´|ä¹‹ä¸­|å½“ä¸­|å…¶ä¸­|ä¸­/.test(processedQuestion);
                
                // å¦‚æœé—®é¢˜åŒ…å«"ä½ è§‰å¾—"ã€"ä½ è®¤ä¸º"ç­‰è¡¨è¾¾è§‚ç‚¹çš„è¯æ±‡ï¼Œé€šå¸¸ä¸éœ€è¦"æ˜¯"
                const isOpinion = /ä½ è§‰å¾—|ä½ è®¤ä¸º|ä½ æƒ³|ä½ å¸Œæœ›|ä½ æœŸæœ›|ä½ æ‹…å¿ƒ|ä½ å®³æ€•|ä½ å–œæ¬¢|ä½ è®¨åŒ|ä½ çˆ±|ä½ æ¨|æ„Ÿè§‰|è®¤ä¸º|æƒ³|å¸Œæœ›|æœŸæœ›|æ‹…å¿ƒ|å®³æ€•|å–œæ¬¢|è®¨åŒ|çˆ±|æ¨/.test(processedQuestion);
                
                // å¦‚æœé—®é¢˜æœ¬èº«å°±æ˜¯å®Œæ•´çš„å¥å­ç»“æ„ï¼Œé€šå¸¸ä¸éœ€è¦"æ˜¯"
                const isCompleteSentence = processedQuestion.length > 15 && hasVerb;
                
                // å¦‚æœç­”æ¡ˆæ˜¯ä¸€ä¸ªå®Œæ•´çš„å¥å­æˆ–åŒ…å«åŠ¨è¯ï¼Œé€šå¸¸ä¸éœ€è¦"æ˜¯"
                const answerHasVerb = /ä¼š|èƒ½|å–œæ¬¢|æ„Ÿè§‰|å¬åˆ°|çœ‹åˆ°|æƒ³|è§‰å¾—|ç»™|ç”¨|å¸®|è®©|æŠŠ|å°†|å˜|æˆ|åš|è¯´|å‘Šè¯‰|è¡¨ç¤º|ç¡®è®¤|å¼€å§‹|ç»“æŸ|å®Œæˆ|è¿›è¡Œ|å‘ç”Ÿ|å‡ºç°|å­˜åœ¨|å±äº|æ„å‘³ç€|ä»£è¡¨|è±¡å¾|ä½“ç°|åæ˜ |è¡¨è¾¾|ä¼ è¾¾|æ˜¾ç¤º|å±•ç°|å‘ˆç°|è¡¨æ˜|è¯æ˜|è¯´æ˜|æŒ‡å‡º|å¼ºè°ƒ|çªå‡º|é‡ç‚¹|å…³é”®|æ ¸å¿ƒ|æœ¬è´¨|æ ¹æœ¬|åŸºç¡€|ä¸»è¦|é‡è¦|ç‰¹åˆ«|ç‰¹æ®Š|ç‹¬ç‰¹|å”¯ä¸€|ä¸“é—¨|ä¸“å±|ä¸ªäºº|ç§äºº|ç§˜å¯†|éšç§|å†…å¿ƒ|æ·±å¤„/.test(answer);
                
                return !hasVerb && !isOpinion && !isCompleteSentence && !answerHasVerb;
            };
            
            // æ ¹æ®ä¸åŒçš„é—®é¢˜ç±»å‹æ™ºèƒ½å¤„ç†
            if (processedQuestion.startsWith('å½“') || processedQuestion.startsWith('åœ¨')) {
                return `${processedQuestion}ï¼Œ${answer}ã€‚`;
            }
            
            if (processedQuestion.startsWith('æœ‰æ²¡æœ‰')) {
                processedQuestion = processedQuestion.replace('æœ‰æ²¡æœ‰', '');
                return needsLogicalConnection(processedQuestion, answer) 
                    ? `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`
                    : `${processedQuestion}ï¼Œ${answer}ã€‚`;
            }
            
            if (processedQuestion.startsWith('ä½ è§‰å¾—') || processedQuestion.startsWith('ä½ è®¤ä¸º')) {
                processedQuestion = processedQuestion.replace(/ä½ è§‰å¾—|ä½ è®¤ä¸º/, '');
                return `å…³äº${processedQuestion}ï¼Œ${answer}ã€‚`;
            }
            
            if (processedQuestion.includes('ä¼šä¸ä¼š')) {
                processedQuestion = processedQuestion.replace('ä¼šä¸ä¼š', 'ä¼š');
                return `${processedQuestion}ï¼Œ${answer}ã€‚`;
            }
            
            if (processedQuestion.includes('æ˜¯è°') || processedQuestion.includes('è°')) {
                processedQuestion = processedQuestion.replace(/æ˜¯è°|è°/g, '');
                return `${processedQuestion}ï¼Œ${answer}ã€‚`;
            }
            
            // é»˜è®¤å¤„ç†ï¼šæ ¹æ®é€»è¾‘è¿æ¥éœ€è¦å†³å®šæ˜¯å¦æ·»åŠ "æ˜¯"
            return needsLogicalConnection(processedQuestion, answer) 
                ? `${processedQuestion}ï¼Œæ˜¯${answer}ã€‚`
                : `${processedQuestion}ï¼Œ${answer}ã€‚`;
        }

        // éšæœºé€‰æ‹©æ•°ç»„ä¸­çš„é¡¹ç›®
        function getRandomItems(array, count) {
            const shuffled = array.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(count, array.length));
        }

        // é‡æ–°ç”Ÿæˆæƒ…ä¹¦
        function generateNewLetter() {
            // é‡ç½®AIæ•…äº‹çŠ¶æ€
            aiStoryGenerated = false;
            const aiText = document.getElementById('ai-btn-text');
            if (aiText) {
                aiText.textContent = 'âœ¨ ä¹¦å†™ä½ ä»¬çš„ä¸“å±æ•…äº‹';
            }
            
            createLoveLetterContent();
            // é‡æ–°åº”ç”¨é¢œè‰²èƒŒæ™¯
            if (userAvatar) {
                extractDominantColorAndApplyBackground(userAvatar);
            }
        }

        // é‡æ–°å¼€å§‹é—®å·
        function restartQuiz() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿè¿™ä¼šæ¸…ç©ºå½“å‰çš„æ‰€æœ‰ç­”æ¡ˆã€‚')) {
                // é‡ç½®æ‰€æœ‰æ•°æ®
                userName = '';
                userAvatar = '';
                quizAnswers = [];
                currentQuestionIndex = 0;
                selectedOptions = [];
                currentAnswerPage = 0;
                aiStoryGenerated = false;
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('userName').value = '';
                document.getElementById('userPhoto').value = '';
                document.getElementById('avatar-area').classList.add('hidden');
                document.getElementById('quiz-avatar').classList.add('hidden');
                
                // è¿”å›è¾“å…¥é¡µ
                showPage('input');
            }
        }

        // ç”ŸæˆAIä¸“å±æ•…äº‹
        async function generateAIStory() {
            if (aiStoryGenerated) {
                // å¦‚æœå·²ç»ç”Ÿæˆè¿‡ï¼Œé‡æ–°ç”Ÿæˆ
                aiStoryGenerated = false;
            }

            const aiBtn = document.getElementById('ai-story-btn');
            const aiText = document.getElementById('ai-btn-text');
            const aiLoading = document.getElementById('ai-loading');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            aiText.classList.add('hidden');
            aiLoading.classList.remove('hidden');
            aiBtn.disabled = true;
            
            try {
                // æ„å»ºç”¨æˆ·æ•…äº‹æ•°æ®
                const storyData = buildStoryData();
                
                // å°è¯•è°ƒç”¨DeepSeek API
                const aiStory = await callDeepSeekAPI(storyData);
                
                if (aiStory) {
                    // æˆåŠŸç”ŸæˆAIæ•…äº‹ï¼Œæ›¿æ¢æƒ…ä¹¦å†…å®¹
                    displayAIStory(aiStory);
                    aiStoryGenerated = true;
                    aiText.textContent = 'ğŸ”„ é‡æ–°åˆ›ä½œæ•…äº‹';
                } else {
                    // APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿç”Ÿæˆ
                    const simulatedStory = generateSimulatedStory(storyData);
                    displayAIStory(simulatedStory);
                    aiStoryGenerated = true;
                    aiText.textContent = 'ğŸ”„ é‡æ–°åˆ›ä½œæ•…äº‹';
                }
                
            } catch (error) {
                console.log('AIæ•…äº‹ç”Ÿæˆå¤±è´¥:', error);
                // é™çº§åˆ°æ¨¡æ‹Ÿç”Ÿæˆ
                const storyData = buildStoryData();
                const simulatedStory = generateSimulatedStory(storyData);
                displayAIStory(simulatedStory);
                aiStoryGenerated = true;
                aiText.textContent = 'ğŸ”„ é‡æ–°åˆ›ä½œæ•…äº‹';
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                aiText.classList.remove('hidden');
                aiLoading.classList.add('hidden');
                aiBtn.disabled = false;
            }
        }

        // æ„å»ºæ•…äº‹æ•°æ®
        function buildStoryData() {
            const validAnswers = quizAnswers.filter(answer => 
                (answer.selectedOption && answer.selectedOption.length > 0) || 
                (answer.customAnswer && answer.customAnswer.trim())
            );
            
            const storyData = {
                userName: userName,
                answers: validAnswers.map(answer => ({
                    question: answer.questionText.replace(/mjg/g, userName),
                    answer: answer.customAnswer && answer.customAnswer.trim() 
                        ? answer.customAnswer 
                        : (Array.isArray(answer.selectedOption) 
                            ? answer.selectedOption.join('ï¼Œ') 
                            : answer.selectedOption),
                    questionId: answer.questionId
                }))
            };
            
            return storyData;
        }

        // è°ƒç”¨DeepSeek API
        async function callDeepSeekAPI(storyData) {
            // æ£€æŸ¥APIå¯†é’¥æ˜¯å¦é…ç½®
            if (!DEEPSEEK_API_KEY || DEEPSEEK_API_KEY === 'your-deepseek-api-key-here') {
                console.log('DeepSeek APIå¯†é’¥æœªé…ç½®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿç”Ÿæˆ');
                return null;
            }

            const prompt = buildAIPrompt(storyData);
            
            const response = await fetch(DEEPSEEK_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: 'system',
                            content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æµªæ¼«å°è¯´ä½œå®¶ï¼Œæ“…é•¿åˆ›ä½œæ²‰æµ¸å¼çš„æ‹çˆ±æ•…äº‹ã€‚ä½ çš„ä½œå“ä»¥ç»†è…»çš„æƒ…æ„Ÿæå†™ã€æ’©äººçš„è§’è‰²å¡‘é€ å’Œå¼ºçƒˆçš„ä»£å…¥æ„Ÿè‘—ç§°ã€‚ä½ ç‰¹åˆ«å–„äºåˆ»ç”»ç†æƒ³ç”·å‹çš„å½¢è±¡ï¼Œè®©è¯»è€…æ„Ÿå—åˆ°è¢«æ·±æ·±å® çˆ±çš„ç”œèœœä½“éªŒã€‚'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.8
                })
            });

            if (!response.ok) {
                throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0]?.message?.content;
        }

        // æ„å»ºAIæç¤ºè¯
        function buildAIPrompt(storyData) {
            // åˆ†æè§’è‰²ç‰¹å¾
            const characterAnalysis = analyzeCharacterTraits(storyData);
            
            const answerSummary = storyData.answers.map(item => 
                `${item.question} â€”â€” ${item.answer}`
            ).join('\n');

            return `è¯·æ ¹æ®ä»¥ä¸‹æƒ…ä¾£é—´çš„äº²å¯†é—®ç­”ï¼Œä¸ºè¯»è€…åˆ›ä½œä¸€ä¸ªæ²‰æµ¸å¼çš„æµªæ¼«çˆ±æƒ…æ•…äº‹ã€‚

ã€è§’è‰²è®¾å®šã€‘
- ç”·ä¸»è§’è‰²ï¼š${storyData.userName}
- è§’è‰²ç‰¹å¾ï¼š${characterAnalysis.traits}
- æ€§æ ¼é­…åŠ›ï¼š${characterAnalysis.charm}

ã€åˆ›ä½œè¦æ±‚ã€‘
1. ä»¥ç¬¬äºŒäººç§°"ä½ "æ¥ç§°å‘¼å¥³ä¸»ï¼ˆè¯»è€…ï¼‰ï¼Œè¥é€ å¼ºçƒˆä»£å…¥æ„Ÿ
2. çªå‡º${storyData.userName}çš„æ€§æ ¼é­…åŠ›å’Œè‹æ„Ÿç»†èŠ‚
3. èå…¥é—®ç­”ä¸­æåˆ°çš„å…·ä½“åœºæ™¯å’Œäº’åŠ¨æ–¹å¼
4. è¯­è¨€æ¸©æŸ”æ’©äººï¼Œå¯Œæœ‰æƒ…æ„Ÿå¼ åŠ›
5. é•¿åº¦300-500å­—ï¼Œåˆ†2-3ä¸ªæ®µè½
6. é‡ç‚¹æå†™${storyData.userName}çš„åŠ¨ä½œã€çœ¼ç¥ã€è¯è¯­å¦‚ä½•è®©"ä½ "å¿ƒåŠ¨
7. è¥é€ æµªæ¼«æ°›å›´ï¼Œè®©è¯»è€…æ„Ÿå—åˆ°è¢«æ·±æ·±å® çˆ±çš„æ„Ÿè§‰

ã€é—®ç­”å†…å®¹ã€‘
${answerSummary}

è¯·åˆ›ä½œä¸€ä¸ªè®©äººå¿ƒåŠ¨çš„ä¸“å±çˆ±æƒ…æ•…äº‹ï¼Œé‡ç‚¹å±•ç°${storyData.userName}ç‹¬ç‰¹çš„é­…åŠ›å’Œå¯¹"ä½ "çš„æ·±æƒ…ï¼š`;
        }

        // åˆ†æè§’è‰²ç‰¹å¾
        function analyzeCharacterTraits(storyData) {
            let traits = [];
            let charm = [];
            
            storyData.answers.forEach(answer => {
                const questionId = answer.questionId;
                const answerText = answer.answer.toLowerCase();
                
                // æ ¹æ®ä¸åŒé—®é¢˜åˆ†æè§’è‰²ç‰¹å¾
                switch(questionId) {
                    case 1: // åœ°ç‚¹åå¥½
                        if (answerText.includes('åŠå…¬å®¤') || answerText.includes('ä¹¦æˆ¿')) {
                            traits.push('æˆç†Ÿç¨³é‡');
                            charm.push('æ·±æ²‰å†…æ•›çš„æ°”è´¨');
                        }
                        if (answerText.includes('å…¬å…±åœºæ‰€') || answerText.includes('åˆºæ¿€')) {
                            traits.push('å‹‡æ•¢æœæ–­');
                            charm.push('ç¥ç§˜è«æµ‹çš„é­…åŠ›');
                        }
                        break;
                        
                    case 2: // ä¸»åŠ¨æ€§
                        if (answerText.includes('çœ¼ç¥') || answerText.includes('ä¸å®¹ç½®ç–‘')) {
                            traits.push('è‡ªä¿¡ä»å®¹');
                            charm.push('æ·±é‚ƒè¿·äººçš„çœ¼ç¥');
                        }
                        if (answerText.includes('æŒ‡å°–') || answerText.includes('æ•æ„Ÿå¸¦')) {
                            traits.push('æ¸©æŸ”ç»†è…»');
                            charm.push('ä½“è´´å…¥å¾®çš„æ¸©æŸ”');
                        }
                        break;
                        
                    case 4: // èº«ä½“é­…åŠ›
                        if (answerText.includes('å–‰ç»“') || answerText.includes('ä½å–˜')) {
                            charm.push('ç£æ€§è¿·äººçš„å£°çº¿');
                        }
                        if (answerText.includes('æ‰‹è‡‚') || answerText.includes('åŠ›é‡')) {
                            charm.push('å¼ºæœ‰åŠ›çš„å®ˆæŠ¤æ„Ÿ');
                        }
                        if (answerText.includes('çœ¼ç¥') || answerText.includes('å¤±æ§')) {
                            charm.push('çœŸå®åŠ¨äººçš„æƒ…æ„Ÿæµéœ²');
                        }
                        break;
                        
                    case 8: // æƒ…è¯é£æ ¼
                        if (answerText.includes('æ ‡è®°') || answerText.includes('è·‘ä¸æ‰')) {
                            traits.push('ä¸“ä¸€æ·±æƒ…');
                            charm.push('å¼ºçƒˆçš„ä¸“å±æ„Ÿå’Œå®‰å…¨æ„Ÿ');
                        }
                        if (answerText.includes('çˆ±ä½ ') || answerText.includes('æŠ±ç´§')) {
                            traits.push('æ·±æƒ…æ¬¾æ¬¾');
                            charm.push('çœŸæŒšæ·±æƒ…çš„çˆ±æ„è¡¨è¾¾');
                        }
                        break;
                }
            });
            
            // é»˜è®¤ç‰¹å¾
            if (traits.length === 0) {
                traits = ['æ¸©æŸ”ä½“è´´', 'æ·±æƒ…ä¸“ä¸€'];
            }
            if (charm.length === 0) {
                charm = ['æ·±é‚ƒçš„çœ¼ç¥', 'æ¸©æš–çš„æ€€æŠ±', 'ä¸“å±çš„æ¸©æŸ”'];
            }
            
            return {
                traits: traits.slice(0, 3).join('ã€'),
                charm: charm.slice(0, 3).join('ã€')
            };
        }

        // æ¨¡æ‹ŸAIæ•…äº‹ç”Ÿæˆï¼ˆå½“APIä¸å¯ç”¨æ—¶ï¼‰
        function generateSimulatedStory(storyData) {
            const characterAnalysis = analyzeCharacterTraits(storyData);
            const randomAnswers = getRandomAnswersForStory(storyData, 3);
            
            const templates = [
                // æ¸©æŸ”å® æººç³»åˆ—
                `æ¯ä¸ªå¥³å­©éƒ½æ¢¦æƒ³ç€æœ‰è¿™æ ·ä¸€ä¸ªäººï¼š${storyData.userName}ã€‚å½“${randomAnswers[0]}çš„æ—¶å€™ï¼Œä»–çš„çœ¼ä¸­åªæœ‰ä½ ï¼Œä»¿ä½›å…¨ä¸–ç•Œéƒ½å¤±å»äº†é¢œè‰²ã€‚ä»–${characterAnalysis.traits}çš„æ€§æ ¼è®©æ¯ä¸€ä¸ªå¹³å‡¡çš„ç¬é—´éƒ½å˜å¾—çè´µæ— æ¯”ã€‚

ä»–æ€»æ˜¯çŸ¥é“åœ¨ä½ éœ€è¦çš„æ—¶å€™ç»™ä½ ${characterAnalysis.charm}ï¼Œæ— è®ºæ˜¯è½»æŠšä½ å› å·¥ä½œè€Œç´§çš±çš„çœ‰å¤´ï¼Œè¿˜æ˜¯åœ¨ä½ ç´¯å¾—æƒ³è¦æ”¾å¼ƒæ—¶å°†ä½ æ‹‰å…¥æ€€ä¸­ã€‚${randomAnswers[1] || 'æ¯ä¸€æ¬¡å¿ƒè·³'}éƒ½åœ¨å‘Šè¯‰ä½ ï¼Œè¿™ä¸ªäººå€¼å¾—ä½ ç”¨ä¸€ç”Ÿå»çæƒœã€‚

åœ¨${storyData.userName}é¢å‰ï¼Œä½ å¯ä»¥å¸ä¸‹æ‰€æœ‰çš„ä¼ªè£…ï¼Œåšæœ€çœŸå®çš„è‡ªå·±ã€‚å› ä¸ºä»–çš„çˆ±å°±åƒæ¸©æš–çš„æ¸¯æ¹¾ï¼Œæ— è®ºå¤–é¢çš„ä¸–ç•Œå¤šä¹ˆç‹‚é£éª¤é›¨ï¼Œä½ æ°¸è¿œæœ‰ä¸€ä¸ªå®‰å…¨çš„å½’å®¿ã€‚`,

                // æ·±æƒ…ä¸“å±ç³»åˆ—
                `å¦‚æœçˆ±æƒ…æœ‰é¢œè‰²ï¼Œé‚£ä¸€å®šæ˜¯${storyData.userName}çœ¼ä¸­åªå±äºä½ çš„é‚£æŠ¹å…‰èŠ’ã€‚${randomAnswers[0]}çš„ç”»é¢å¦‚ç”µå½±èˆ¬åœ¨ä½ å¿ƒä¸­å¾ªç¯æ’­æ”¾ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯ä»–${characterAnalysis.traits}çš„è§è¯ï¼Œæ¯ä¸€ç§’éƒ½è®©ä½ æ›´åŠ ç¡®å®šâ€”â€”è¿™å°±æ˜¯ä½ è¦çš„çˆ±æƒ…ã€‚

ä»–æœ‰ä¸€ç§ç¥å¥‡çš„é­”åŠ›ï¼Œèƒ½å¤Ÿè®©æ—¶é—´åœ¨ä»–çš„${characterAnalysis.charm}ä¸­é™æ­¢ã€‚æ— è®ºæ˜¯${randomAnswers[1] || 'ä»–ä½å¤´çœ‹ä½ '}çš„ä¸“æ³¨çœ¼ç¥ï¼Œè¿˜æ˜¯é‚£äº›åªæœ‰ä½ ä»¬æ‰æ‡‚çš„é»˜å¥‘ç¬é—´ï¼Œéƒ½åœ¨ç¼–ç»‡ç€ä¸“å±äºä½ ä»¬çš„çˆ±æƒ…ç«¥è¯ã€‚

è¿™ä»½æ„Ÿæƒ…å¦‚æ­¤çè´µï¼Œå› ä¸ºå®ƒæ‰¿è½½ç€ä¸¤ä¸ªäººæœ€çœŸæŒšçš„å¿ƒæ„ã€‚åœ¨${storyData.userName}çš„ä¸–ç•Œé‡Œï¼Œä½ ä¸ä»…ä»…æ˜¯æ‹äººï¼Œæ›´æ˜¯ä»–å¿ƒä¸­ç‹¬ä¸€æ— äºŒçš„å¥³ç‹ï¼Œè¢«æ— æ¡ä»¶åœ°å® çˆ±ç€ã€‚`,

                // ç”œèœœæ—¥å¸¸ç³»åˆ—
                `æœ‰äº›å¹¸ç¦å¾ˆç®€å•ï¼Œæ¯”å¦‚${storyData.userName}æ¯å¤©æ—©æ™¨çš„ç¬¬ä¸€ä¸ªå»ï¼Œæ¯”å¦‚${randomAnswers[0]}æ—¶ä»–ä¸ç»æ„é—´çš„æ¸©æŸ”ã€‚ä»–${characterAnalysis.traits}çš„æ¨¡æ ·æ·±æ·±å°åœ¨ä½ çš„ç”Ÿæ´»é‡Œï¼Œè®©å¹³å‡¡çš„æ—¥å­éƒ½æŸ“ä¸Šäº†ç²‰è‰²çš„æµªæ¼«ã€‚

æ¯å½“ä½ æƒ³èµ·ä»–çš„${characterAnalysis.charm}ï¼Œå˜´è§’å°±ä¼šä¸è‡ªè§‰åœ°ä¸Šæ‰¬ã€‚${randomAnswers[1] || 'é‚£äº›å¾®å°çš„ç»†èŠ‚'}æ€»æ˜¯èƒ½ç¬é—´æ²»æ„ˆä½ ä¸€å¤©çš„ç–²æƒ«ï¼Œè®©ä½ æ˜ç™½ä»€ä¹ˆå«åšå°ç¡®å¹¸ï¼Œä»€ä¹ˆå«åšè¢«çˆ±åŒ…å›´çš„æ„Ÿè§‰ã€‚

è¿™å°±æ˜¯ä½ ä»¬çš„çˆ±æƒ…æ•…äº‹ï¼Œæ²¡æœ‰è½°è½°çƒˆçƒˆçš„æˆå‰§æ€§ï¼Œå´æœ‰ç€æœ€è¸å®çš„å¹¸ç¦æ„Ÿã€‚åœ¨${storyData.userName}çš„é™ªä¼´ä¸‹ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯å€¼å¾—æœŸå¾…çš„ç¾å¥½ã€‚`,

                // å¿ƒåŠ¨æ’©äººç³»åˆ—
                `${storyData.userName}æ€»æ˜¯æœ‰åŠæ³•è®©ä½ çš„å¿ƒè·³ç¬é—´å¤±å»èŠ‚æ‹ã€‚æ— è®ºæ˜¯${randomAnswers[0]}çš„ç¬é—´ï¼Œè¿˜æ˜¯ä»–é‚£ç§${characterAnalysis.traits}çš„é­…åŠ›å±•ç°ï¼Œéƒ½èƒ½è½»æ˜“ä¿˜è·ä½ çš„å¿ƒï¼Œè®©ä½ æ²‰æººåœ¨ç”œèœœçš„é™·é˜±é‡Œæ— æ³•è‡ªæ‹”ã€‚

ä»–çš„${characterAnalysis.charm}å°±åƒæœ€è‡´å‘½çš„æ­¦å™¨ï¼Œæ€»æ˜¯åœ¨æœ€ä¸ç»æ„çš„æ—¶å€™å‡»ä¸­ä½ å¿ƒä¸­æœ€æŸ”è½¯çš„åœ°æ–¹ã€‚${randomAnswers[1] || 'æ¯ä¸€æ¬¡æ·±æƒ…çš„æ³¨è§†'}éƒ½åƒæ˜¯åœ¨è¯´ï¼š"ä½ æ˜¯æˆ‘çš„ï¼Œä»ä»Šå¾€åï¼Œä»ç”Ÿåˆ°æ­»ã€‚"

åœ¨è¿™åœºçˆ±æƒ…æ¸¸æˆé‡Œï¼Œä½ ä»¬éƒ½æ˜¯å½¼æ­¤çš„ä¿˜è™ã€‚${storyData.userName}ç”¨ä»–ç‹¬ç‰¹çš„æ–¹å¼å®£å‘Šç€å¯¹ä½ çš„å æœ‰ï¼Œè€Œä½ ï¼Œç”˜æ„¿æˆä¸ºä»–ä¸–ç•Œé‡Œå”¯ä¸€çš„å…¬ä¸»ã€‚`,

                // æ·±å±‚è¿ç»“ç³»åˆ—
                `çˆ±æƒ…æœ€ç¾çš„æ ·å­ï¼Œå¤§æ¦‚å°±æ˜¯åƒä½ å’Œ${storyData.userName}è¿™æ ·ï¼Œä¸éœ€è¦å¤ªå¤šè¨€è¯­ï¼Œä¸€ä¸ªçœ¼ç¥å°±èƒ½è¯»æ‡‚å½¼æ­¤çš„å¿ƒæ€ã€‚å½“${randomAnswers[0]}çš„æ—¶å€™ï¼Œé‚£ç§çµé­‚æ·±å¤„çš„å…±é¸£è®©ä½ ä»¬è¶…è¶Šäº†æ™®é€šçš„æ‹äººå…³ç³»ã€‚

ä»–${characterAnalysis.traits}çš„æœ¬è´¨åœ¨ä¸ä½ ç›¸å¤„çš„æ¯ä¸ªç»†èŠ‚ä¸­å±•ç°æ— é—ã€‚æ— è®ºæ˜¯${randomAnswers[1] || 'é™é™ç›¸æ‹¥çš„å¤œæ™š'}ï¼Œè¿˜æ˜¯é‚£äº›åªå±äºä½ ä»¬çš„ç§˜å¯†æ—¶å…‰ï¼Œéƒ½åœ¨è§è¯ç€è¿™ä»½æ„Ÿæƒ…çš„æ·±åº¦å’Œçº¯ç²¹ã€‚

æœ‰äººè¯´çœŸçˆ±éš¾å¾—ï¼Œä½†ä½ ä»¬ç”¨æœ€çœŸå®çš„ç›¸å¤„è¯æ˜äº†ä»€ä¹ˆå«åšå¤©ä½œä¹‹åˆã€‚åœ¨${storyData.userName}çš„ä¸–ç•Œé‡Œï¼Œä½ ä¸ä»…æ‰¾åˆ°äº†çˆ±äººï¼Œæ›´æ‰¾åˆ°äº†çµé­‚çš„å¦ä¸€åŠã€‚`,

                // æœªæ¥æ†§æ†¬ç³»åˆ—
                `æ¯ä¸ªå¥³å­©éƒ½å€¼å¾—ä¸€ä¸ªåƒ${storyData.userName}è¿™æ ·çš„äººï¼Œä¸€ä¸ªèƒ½å¤Ÿè®©ä½ å¯¹æœªæ¥å……æ»¡æœŸå¾…çš„äººã€‚æƒ³è±¡ç€å¤šå¹´åï¼Œå½“${randomAnswers[0]}çš„ç”»é¢é‡æ–°ä¸Šæ¼”ï¼Œä»–ä¾ç„¶ä¼šç”¨é‚£ç§${characterAnalysis.traits}çš„çœ¼ç¥çœ‹ç€ä½ ï¼Œå²æœˆä»æœªæ”¹å˜ä»–å¯¹ä½ çš„æ·±æƒ…ã€‚

ä»–çš„${characterAnalysis.charm}ä¸ä»…ä»…å±äºç°åœ¨ï¼Œæ›´å±äºä½ ä»¬å…±åŒè§„åˆ’çš„æ¯ä¸€ä¸ªæ˜å¤©ã€‚${randomAnswers[1] || 'é‚£äº›å…³äºæœªæ¥çš„è°ˆè¯'}æ€»æ˜¯è®©ä½ ç¡®ä¿¡ï¼Œè¿™ä¸ªäººå€¼å¾—ä½ äº¤ä»˜ä¸€ç”Ÿçš„ä¿¡ä»»å’Œçˆ±æ„ã€‚

è¿™ä»½çˆ±æƒ…å¦‚æ­¤çè´µï¼Œå› ä¸ºå®ƒä¸ä»…ä»…æ˜¯å½“ä¸‹çš„ç”œèœœï¼Œæ›´æ˜¯å¯¹æœªæ¥çš„æ‰¿è¯ºã€‚ä¸${storyData.userName}åœ¨ä¸€èµ·ï¼Œä½ çœ‹åˆ°çš„ä¸åªæ˜¯ä»Šå¤©çš„å¿«ä¹ï¼Œæ›´æ˜¯ä¸€ç”Ÿçš„å¹¸ç¦å¯èƒ½ã€‚`,

                // ç‹¬ç‰¹é­…åŠ›ç³»åˆ—
                `ä¸–ç•Œä¸Šæœ‰é‚£ä¹ˆå¤šäººï¼Œä½†åªæœ‰${storyData.userName}èƒ½è®©ä½ æ„Ÿå—åˆ°è¿™ç§ç‹¬ç‰¹çš„å¿ƒåŠ¨ã€‚ä»–${characterAnalysis.traits}çš„é­…åŠ›å°±åƒç£é“ä¸€æ ·ï¼Œä¸ç»æ„é—´å°±èƒ½å¸å¼•ä½ æ‰€æœ‰çš„æ³¨æ„åŠ›ã€‚å½“${randomAnswers[0]}çš„æ—¶å€™ï¼Œä½ æ€»æ˜¯å¿ä¸ä½æƒ³ï¼š"è¿™ä¸ªäººï¼ŒçœŸçš„æ˜¯ä¸ºæˆ‘è€Œç”Ÿçš„å—ï¼Ÿ"

ä»–çš„${characterAnalysis.charm}åœ¨ä½ çœ¼ä¸­æ°¸è¿œéƒ½æ˜¯æœ€è¿·äººçš„é£æ™¯ã€‚${randomAnswers[1] || 'æ¯ä¸€ä¸ªä¸“å±äºä½ ä»¬çš„ç¬é—´'}éƒ½åœ¨æé†’ä½ ï¼Œè¿™ä»½æ„Ÿæƒ…çš„çè´µå’Œä¸å¯æ›¿ä»£ï¼Œè®©ä½ æ›´åŠ çæƒœæ‹¥æœ‰ä»–çš„æ¯ä¸€å¤©ã€‚

åœ¨èŒ«èŒ«äººæµ·ä¸­ç›¸é‡å¹¶ç›¸çˆ±ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ç§å¥‡è¿¹ã€‚è€Œ${storyData.userName}ç”¨ä»–çš„æ–¹å¼è¯ é‡Šç€ä»€ä¹ˆå«åšå‘½ä¸­æ³¨å®šï¼Œä»€ä¹ˆå«åšæ­¤ç”Ÿæ— æ‚”ã€‚`,

                // å®‰å…¨æ„Ÿæ»¡æ»¡ç³»åˆ—
                `å®‰å…¨æ„Ÿæ˜¯ä»€ä¹ˆï¼Ÿå¤§æ¦‚å°±æ˜¯${storyData.userName}ç»™ä½ çš„é‚£ç§"æ— è®ºä½•æ—¶ä½•åœ°ï¼Œä»–éƒ½åœ¨"çš„è¸å®æ„Ÿã€‚ä»–${characterAnalysis.traits}çš„æ€§æ ¼è®©ä½ æ˜ç™½ï¼Œæœ‰äº›äººçš„å‡ºç°å°±æ˜¯ä¸ºäº†æ²»æ„ˆä½ è¿‡å»æ‰€æœ‰çš„ä¸å®‰å’Œææƒ§ã€‚

å½“${randomAnswers[0]}çš„æ—¶å€™ï¼Œä»–çš„${characterAnalysis.charm}å°±åƒæœ€å¼ºçš„ä¿æŠ¤ç½©ï¼Œå°†ä½ åŒ…å›´åœ¨ç»å¯¹å®‰å…¨çš„ç©ºé—´é‡Œã€‚${randomAnswers[1] || 'æ¯ä¸€æ¬¡æ¸©æš–çš„æ‹¥æŠ±'}éƒ½åœ¨æ— å£°åœ°å‘Šè¯‰ä½ ï¼š"æœ‰æˆ‘åœ¨ï¼Œä½ ä»€ä¹ˆéƒ½ä¸ç”¨æ€•ã€‚"

è¿™å°±æ˜¯ä½ ä¸€ç›´åœ¨å¯»æ‰¾çš„é‚£ä¸ªäººï¼Œä¸€ä¸ªèƒ½å¤Ÿç»™ä½ ç»å¯¹å®‰å…¨æ„Ÿçš„äººã€‚åœ¨${storyData.userName}çš„çˆ±é‡Œï¼Œä½ ç»ˆäºå¯ä»¥æ”¾ä¸‹æ‰€æœ‰çš„æˆ’å¤‡ï¼Œåšä¸€ä¸ªè¢«å® çˆ±ç€çš„å°å¥³å­©ã€‚`
            ];

            // éšæœºé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿
            const selectedTemplate = templates[Math.floor(Math.random() * templates.length)];
            
            // å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ç­”æ¡ˆï¼Œä½¿ç”¨é»˜è®¤å†…å®¹å¡«å……
            return selectedTemplate.replace(/undefined/g, 'å’Œä½ åœ¨ä¸€èµ·çš„æ—¶å…‰');
        }

        // è·å–éšæœºç­”æ¡ˆç”¨äºæ•…äº‹ç”Ÿæˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        function getRandomAnswersForStory(storyData, count) {
            if (storyData.answers.length === 0) return ["ä½ ä»¬ç›¸å¤„", "å’Œä»–åœ¨ä¸€èµ·", "ä»–ç»™ä½ çš„æ¸©æš–"];
            
            // ä¼˜å…ˆé€‰æ‹©æ›´æœ‰æ•…äº‹æ€§çš„ç­”æ¡ˆ
            const priorityAnswers = storyData.answers.filter(answer => {
                const text = answer.answer.toLowerCase();
                return text.length > 10 || // è¾ƒé•¿çš„è‡ªå®šä¹‰ç­”æ¡ˆ
                       text.includes('ä»–') || 
                       text.includes('ä½ ') ||
                       text.includes('çœ¼ç¥') ||
                       text.includes('æŠšæ‘¸') ||
                       text.includes('äº²å»') ||
                       text.includes('æ€€æŠ±');
            });
            
            const selectedAnswers = priorityAnswers.length > 0 ? priorityAnswers : storyData.answers;
            const shuffled = selectedAnswers.sort(() => 0.5 - Math.random());
            const result = shuffled.slice(0, count).map(answer => answer.answer);
            
            // å¦‚æœç­”æ¡ˆä¸å¤Ÿï¼Œç”¨é»˜è®¤å†…å®¹å¡«å……
            while (result.length < count) {
                const defaults = ["ä½ ä»¬ä¸€èµ·çš„ç¾å¥½æ—¶å…‰", "ä»–å¯¹ä½ çš„æ·±æƒ…", "é‚£äº›ä¸“å±çš„ç”œèœœç¬é—´"];
                result.push(defaults[result.length % defaults.length]);
            }
            
            return result;
        }

        // æ˜¾ç¤ºAIç”Ÿæˆçš„æ•…äº‹
        function displayAIStory(story) {
            const letterContent = document.getElementById('love-letter-content');
            
            // åˆ›å»ºAIæ•…äº‹å®¹å™¨
            const storyContainer = document.createElement('div');
            storyContainer.className = 'relative group mb-3';
            
            const contentBox = document.createElement('div');
            contentBox.className = 'relative backdrop-blur-xl bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-300/20 rounded-xl p-4 shadow-lg';
            
            contentBox.innerHTML = `
                <div class="flex items-center space-x-2 mb-3">
                    <div class="w-5 h-5 rounded-full bg-gradient-to-r from-purple-400/60 to-pink-400/60 flex items-center justify-center shadow-sm backdrop-blur-sm">
                        <span class="text-white text-xs">âœ¨</span>
                    </div>
                    <p class="text-purple-300 italic text-xs font-serif opacity-80">ä¸“å±çˆ±æƒ…æ•…äº‹</p>
                    <div class="flex-1"></div>
                    <div class="w-2 h-2 bg-purple-400/40 rounded-full animate-pulse"></div>
                </div>
                <div class="text-gray-100 leading-relaxed text-sm font-serif group-hover:text-white transition-colors duration-300 whitespace-pre-wrap">${story}</div>
            `;
            
            storyContainer.appendChild(contentBox);
            
            // æ¸…ç©ºåŸå†…å®¹å¹¶æ·»åŠ AIæ•…äº‹
            letterContent.innerHTML = '';
            letterContent.appendChild(storyContainer);
        }

        // ç›‘å¬å§“åè¾“å…¥
        document.getElementById('userName').addEventListener('input', checkInputComplete);

        // åˆå§‹åŒ–åŠ¨ç”»
        function initAnimations() {
            setInterval(() => {
                // é‡æ–°å¯åŠ¨é£˜è½åŠ¨ç”»ï¼Œåªæœ‰çˆ±å¿ƒå’Œæ¨±èŠ±
                const hearts = ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’'];
                const flowers = ['ğŸŒ¸'];
                const allElements = [...hearts, ...flowers];
                const colors = ['text-aurora', 'text-rose-glow', 'text-pink-dream', 'text-pink-300', 'text-pink-200'];
                const positions = ['5%', '15%', '25%', '35%', '45%', '55%', '65%', '75%', '85%', '95%'];
                
                const randomElement = allElements[Math.floor(Math.random() * allElements.length)];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                const randomPos = positions[Math.floor(Math.random() * positions.length)];
                const randomSize = ['text-lg', 'text-xl'][Math.floor(Math.random() * 2)];
                const randomDelay = Math.random() * 2;
                const randomOpacity = ['opacity-40', 'opacity-50', 'opacity-60', 'opacity-70'][Math.floor(Math.random() * 4)];
                
                const element = document.createElement('div');
                element.className = `absolute top-0 ${randomColor} ${randomSize} falling pointer-events-none ${randomOpacity}`;
                element.style.left = randomPos;
                element.style.animationDelay = randomDelay + 's';
                element.textContent = randomElement;
                
                document.getElementById('animation-bg').appendChild(element);
                
                // æ¸…ç†æ—§å…ƒç´ 
                setTimeout(() => {
                    if (element.parentNode) {
                        element.parentNode.removeChild(element);
                    }
                }, 10000);
            }, 5000); // å‡å°‘ç”Ÿæˆé¢‘ç‡ï¼Œé¿å…è¿‡å¤š
        }

        // å¯åŠ¨åŠ¨ç”»
        initAnimations();
    </script>
</body>
</html>